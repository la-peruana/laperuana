<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La Peruana — Tienda Online</title>
  <meta name="description" content="E‑commerce sin backend — Tienda online de La Peruana" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <style>
    :root{ --bg:#f8fafc; --card:#ffffff; --muted:#475569; --text:#0f172a; --primary:#e54244; --primary-600:#c12f31; --shadow:0 10px 30px rgba(0,0,0,.10); --radius:18px; --accent:#ffe059; }
    [data-theme="dark"]{ --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e2e8f0; --shadow:0 10px 30px rgba(0,0,0,.35) }
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}

    /* Header */
    header{position:sticky;top:0;z-index:20;backdrop-filter:blur(8px);background:rgba(255,255,255,.9);border-bottom:1px solid rgba(148,163,184,.25)}
    [data-theme="dark"] header{background:rgba(15,23,42,.85)}
    .h-in{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:36px;border-radius:10px}
    .search{position:relative;flex:1;min-width:240px;max-width:520px}
    .search input{width:100%;padding:12px 42px;border-radius:999px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)}
    [data-theme="dark"] .search input{background:#0b1220;border-color:#334155;color:#e2e8f0}
    .search i{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--muted)}
    .toggle,.btn-lite{border:1px solid rgba(148,163,184,.25);padding:8px 12px;border-radius:999px;display:inline-flex;gap:8px;align-items:center;cursor:pointer;background:#fff;color:var(--text)}
    [data-theme="dark"] .toggle,[data-theme="dark"] .btn-lite{background:#0b1220;border-color:#334155;color:#e2e8f0}

    /* Layout */
    .layout{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:260px 1fr;gap:16px}
    @media(max-width:980px){ .layout{grid-template-columns:1fr} }
    .side{background:var(--card);border:1px solid rgba(148,163,184,.2);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .cats button{width:100%;text-align:left;margin-bottom:6px;padding:10px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#fff;color:var(--text);cursor:pointer}
    .cats button.active{border-color:var(--primary);background:linear-gradient(0deg, rgba(229,66,68,.07), transparent)}
    [data-theme="dark"] .cats button{background:#0b1220;color:#e2e8f0;border-color:#334155}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;align-items:center}
    .toolbar select, .toolbar input{padding:10px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)}
    [data-theme="dark"] .toolbar select, [data-theme="dark"] .toolbar input{background:#0b1220;border-color:#334155;color:#e2e8f0}

    /* Cards */
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.2);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .thumb{height:150px;background:#f1f5f9;display:grid;place-items:center;color:#e11d48;font-size:26px;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    [data-theme="dark"] .thumb{background:linear-gradient(135deg, rgba(34,197,94,.12), rgba(6,182,212,.12))}
    .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .name{font-weight:900;line-height:1.15}
    .unit{font-size:12px;color:var(--muted)}
    .price{font-weight:900}
    .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:auto}
    .btn{border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text);border-radius:10px;padding:10px 12px;cursor:pointer}
    [data-theme="dark"] .btn{background:#0b1220;color:#e2e8f0;border-color:#334155}
    .qty{display:flex;gap:6px;align-items:center}
    .qty .icon{width:34px;height:34px;display:grid;place-items:center;border:1px solid rgba(148,163,184,.25);border-radius:8px;cursor:pointer;background:#fff;color:var(--text)}
    [data-theme="dark"] .qty .icon{background:#0b1220;color:#e2e8f0;border-color:#334155}

    /* Cart FAB + Modal */
    .cart-fab{position:fixed;top:16px;right:16px;background:var(--primary);color:#fff;border:none;border-radius:999px;box-shadow:0 6px 22px rgba(229,66,68,.35);padding:.7em 1.1em;font-size:1.02em;z-index:90;cursor:pointer;display:flex;align-items:center;gap:.6em;font-weight:800}
    .cart-pill{display:inline-flex;background:var(--accent);color:#7a1517;border-radius:999px;font-weight:800;font-size:.93em;padding:.12em .6em;align-items:center;gap:.4em}

    .modal-bg{display:none;position:fixed;z-index:100;inset:0;background:rgba(0,0,0,.35);align-items:center;justify-content:center}
    .modal-bg.active{display:flex}
    .modal{background:var(--card);border-radius:18px;max-width:560px;width:96vw;padding:1.2em .9em .9em .9em;box-shadow:0 10px 40px rgba(0,0,0,.25);position:relative}
    .modal h2{margin:.2em 2.2em .2em 2.2em;color:var(--primary);text-align:center}
    .close{position:absolute;top:.5em;right:.6em;background:transparent;border:none;font-size:1.6em;color:var(--primary-600);cursor:pointer}
    .carrito-list{max-height:320px;overflow-y:auto;margin:.7em 0 .9em;padding:0 .3em}
    .row{display:grid;grid-template-columns:1fr auto auto auto auto;gap:.5em;align-items:center;padding:.55em 0;border-bottom:1px solid rgba(148,163,184,.2)}
    .row-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .row-mini{display:flex;gap:.35em}
    .mini{width:26px;height:26px;border-radius:50%;border:none;background:var(--primary);color:#fff;font-weight:900;cursor:pointer}
    .row-price{text-align:right;min-width:80px}
    .row-sub{text-align:right;min-width:80px}
    .row-remove{border:1px solid rgba(148,163,184,.25);background:#fff;border-radius:10px;padding:.25em .55em;color:#777;cursor:pointer}
    [data-theme="dark"] .row-remove{background:#0b1220;color:#e2e8f0;border-color:#334155}

    .modal-actions{display:flex;gap:.6em;justify-content:space-between;align-items:center;margin-top:.6em}
    .btn-clear{background:#fff;color:#c1121f;border:1px solid #f0b1b5;border-radius:12px;padding:.55em .9em;cursor:pointer;font-weight:800}
    .total{font-weight:900;color:var(--primary);font-size:1.14em;flex:1;text-align:right}
    .btn-wa{display:block;width:100%;background:#25D366;color:#fff;font-weight:900;border:none;border-radius:24px;padding:.8em 0;font-size:1.08em;text-decoration:none;cursor:pointer;margin-top:.4em;box-shadow:0 4px 18px rgba(37,211,102,.35);text-align:center}

    .toast{position:fixed;right:12px;bottom:12px;background:#052e16;color:#bbf7d0;border:1px solid #166534;padding:10px 12px;border-radius:10px;display:none;z-index:1000}
    .toast.show{display:block}
  </style>
</head>
<body>
  <header>
    <div class="h-in">
      <div class="brand">
        <img src="LOGO-LA-PERUANA.jpg" alt="La Peruana" />
        <strong>La Peruana</strong>
      </div>
      <div class="search">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="q" placeholder="Buscar (ej: medialuna, sandwich, queso…)"/>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn-lite" id="themeToggle"><i class="fa-solid fa-moon"></i> <span id="themeLabel">Claro</span></button>
      </div>
    </div>
  </header>

  <button class="cart-fab" id="openCart"><i class="fa-solid fa-cart-shopping"></i><span>Carrito</span> <span class="cart-pill"><span id="cartCount">0</span> • <span id="cartTotal">$0</span></span></button>

  <div class="layout">
    <aside class="side">
      <h3>Categorías</h3>
      <div id="cats" class="cats"></div>
      <hr style="border-color:rgba(148,163,184,.2)">
      <h3>Filtros</h3>
      <div class="toolbar">
        <select id="sort">
          <option value="relevance">Relevancia</option>
          <option value="price_asc">Precio ↑</option>
          <option value="price_desc">Precio ↓</option>
          <option value="alpha">A–Z</option>
        </select>
        <input id="minp" placeholder="Precio min">
        <input id="maxp" placeholder="Precio max">
        <button class="btn" id="apply">Aplicar</button>
        <button class="btn" id="clear">Limpiar</button>
      </div>
    </aside>

    <main>
      <div class="grid" id="grid"></div>
    </main>
  </div>

  <!-- Modal Carrito (detalle y confirmación) -->
  <div class="modal-bg" id="cartModalBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <button class="close" id="closeCart" title="Cerrar" aria-label="Cerrar">&times;</button>
      <h2 id="cartTitle">Tu Carrito</h2>
      <div class="carrito-list" id="cartList"></div>
      <div class="modal-actions">
        <button class="btn-clear" id="btnClear">Eliminar todo</button>
        <div class="total" id="cartTotalModal"></div>
      </div>
      <a class="btn-wa" id="btnWA" target="_blank" rel="noopener">Confirmar y enviar por WhatsApp</a>
    </div>
  </div>

  <div class="toast" id="toast">Agregado al carrito</div>

  <script>
    // ===== Config =====
    // Cambiá esta ruta si preferís apuntar a tu repo GitHub (por ejemplo, a /assets/img/ del repo Pages)
    // Ejemplo absoluto: const IMAGE_BASE = "https://raw.githubusercontent.com/la-peruana/laperuana/main/img/";
    const IMAGE_BASE = "./img/"; // usar carpeta /img/ del mismo sitio
    const WHATSAPP_NUMBER = "5493435075991"; // sin + ni espacios

    // ===== Utilidades =====
    const CURRENCY = new Intl.NumberFormat("es-AR", {style:"currency", currency:"ARS", maximumFractionDigits:0});
    const fmt = n => CURRENCY.format(n);
    const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");

    const PLACEHOLDER_IMG = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='%23f1f5f9'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%2394a3b8' font-size='28' font-family='Arial'>Imagen</text></svg>";

    // ===== Catálogo (estático, sin Sheets) =====
    const Categories = [
      { id:"rotiseria", name:"Rotisería", icon:"fa-utensils" },
      { id:"panaderia", name:"Panadería", icon:"fa-bread-slice" },
      { id:"pasteleria", name:"Pastelería", icon:"fa-cake-candles" },
      { id:"carniceria", name:"Carnicería", icon:"fa-drumstick-bite" },
      { id:"verduleria", name:"Verdulería", icon:"fa-carrot" },
      { id:"fiambreria", name:"Fiambrería", icon:"fa-cheese" },
      { id:"almacen", name:"Almacén", icon:"fa-boxes-stacked" },
      { id:"bebidas", name:"Bebidas", icon:"fa-champagne-glasses" }
    ];

    // Para mantener el catálogo corto aquí, se incluyen ejemplos. Podés extenderlo copiando la estructura.
    let Catalog = {
  { nombre: "PANADERIA", productos: [
        { nombre: "Facturas con crema x 3 un", precio: 2177, imagen: "facturas-crema.jpg" },
        { nombre: "Facturas con crema y membrillo x 3 un", precio: 2613, imagen: "facturas-crema-membrillo.jpg" },
        { nombre: "Facturas con crema y dulce de leche x 3 un", precio: 1960, imagen: "facturas-crema-ddl.jpg" },
        { nombre: "Medialunas con dulce de leche x 3 un", precio: 2449, imagen: "medialuna-ddl.jpg" },
        { nombre: "Medialunas dulces x 3 un", precio: 1851, imagen: "medialuna-dulce.jpg" },
        { nombre: "Vigiantes de batata x 3 un", precio: 2504, imagen: "vigilantes-batata.jpg" },
        { nombre: "Vigilantes de membrillo x 3 un", precio: 2308, imagen: "vigilantes-membrillo.jpg" },
        { nombre: "Bollitos con crema x 3 un", precio: 2068, imagen: "bollitos-crema.jpg" },
        { nombre: "Bollitos con dulce de leche x 3 un", precio: 1960, imagen: "bollitos-ddl.jpg" },
        { nombre: "Empanaditas de dulce de leche x 3 un", precio: 1415, imagen: "empanaditas-ddl.jpg" },
        { nombre: "Pirulines x 3 un", precio: 2177, imagen: "pirulines.jpg" },
        { nombre: "Borrachitos x 3 un", precio: 1960, imagen: "borrachitos.jpg" },
        { nombre: "Medialunas marplatenses x 3 un", precio: 1933, imagen: "medialunas-marplatenses.jpg" },
        { nombre: "Especiales x 250grs", precio: 2363, imagen: "especiales.jpg" },
        { nombre: "Pan frances x 250grs", precio: 740, imagen: "pan-frances.jpg" },
        { nombre: "Galleta de campo x 250grs", precio: 840, imagen: "galleta-campo.jpg" },
        { nombre: "Galleta hojaldrada x 250grs", precio: 1018, imagen: "galleta-hojaldrada.jpg" },
        { nombre: "Suizos x 250grs", precio: 3319, imagen: "suizos.jpg" },
        { nombre: "Medialunas saladas grandes x 250grs", precio: 3281, imagen: "medialuna-salada-grande.jpg" },
        { nombre: "Medialunas saladas chicas x 250grs", precio: 4024, imagen: "medialuna-salada-chica.jpg" },
        { nombre: "Croissant x 1 un", precio: 2464, imagen: "Croissant.jpg" }
      ]},
      { nombre: "PASTELERIA", productos: [
        { nombre: "Cheese cake individual", precio: 6362, imagen: "cheesecake-individual.jpg" },
        { nombre: "Torta mini bombon", precio: 1019, imagen: "torta-mini-bombon.jpg" },
        { nombre: "Torta mini lemon pie", precio: 1019, imagen: "torta-mini-lemonpie.jpg" },
        { nombre: "Torta mini frutal", precio: 1551, imagen: "torta-mini-frutal.jpg" },
        { nombre: "Lingote de durazno", precio: 2038, imagen: "lingote-durazno.jpg" },
        { nombre: "Lingote de frutilla", precio: 2038, imagen: "lingote-frutilla.jpg" },
        { nombre: "Red Velvet individual", precio: 1699, imagen: "red-velvet.jpg" },
        { nombre: "Tiramisú individual", precio: 3057, imagen: "tiramisu-individual.jpg" },
        { nombre: "Masas finas x 7 un", precio: 7427, imagen: "masas-finas.jpg" },
        { nombre: "Alfajores de maicena grandes x 2 un", precio: 1362, imagen: "alfajor-maicena-grande.jpg" },
        { nombre: "Alfajores de maicena medianos x 3 un", precio: 1424, imagen: "alfa-maicena-med.jpg" },
        { nombre: "Alfajores de maicena mini x 5 un", precio: 1485, imagen: "alfajor-maicena-grande.jpg" },
        { nombre: "Alfajores de chocolate grande x 2 un", precio: 1820, imagen: "alfajor-choco-gr.jpg" },
        { nombre: "Alfajores de chocolate mediano x 3 un", precio: 1903, imagen: "alfajor-choco-med.jpg" },
        { nombre: "Alfajores de chocolate mini x 5 un", precio: 1986, imagen: "alfajor-choco-mini.jpg" }
     ]},
      { nombre: "ROTISERIA", productos: [
        { nombre: "Torrejas de arroz x 3 un", precio: 1225, imagen: "torrejas-arroz.jpg" },
        { nombre: "Torrejas de acelga x 3 un", precio: 1225, imagen: "torrejas-acelga.jpg" },
        { nombre: "Bandeja de sandwich de miga simple x 6 un", precio: 12846, imagen: "Sandwich-simples.jpg" },
        { nombre: "Bandeja de sandwich de miga triples x 6 un", precio: 13588, imagen: "miga-triple.jpg" },
        { nombre: "Tarta de pollo -porción-", precio: 7096, imagen: "tarta-pollo.jpg" },
        { nombre: "Tortilla de acelga -porción-", precio: 4863, imagen: "tortilla-acelga.jpg" },
        { nombre: "Tortilla de verduras -porción-", precio: 4863, imagen: "Tortilla-verduras.jpg" },
        { nombre: "Terrina acelga -porción-", precio: 3633, imagen: "terrina.jpg" },
        { nombre: "Terrina verdura -porción-", precio: 3633, imagen: "terrina-verduras.jpg" },
        { nombre: "Papas fritas -porción-", precio: 2591, imagen: "papas-fritas.jpg" },
        { nombre: "Patamuslo x 2 un", precio: 13196, imagen: "patamuslo.jpg" },
        { nombre: "Sandwich milanesa de pollo", precio: 5637, imagen: "sandwich-milanesa-pollo.jpg" },
        { nombre: "Sandwich milanesa de carne simple", precio: 8176, imagen: "sandwich-mila-carne.jpg" },
        { nombre: "Sandwich milanesa de carne completo", precio: 9638, imagen: "sandwich-mila-carne-completo.jpg" },
        { nombre: "Pebete de jamon y queso", precio: 3192, imagen: "Pebete.jpg" },
        { nombre: "Empanadas de choclo x 3 un", precio: 6168, imagen: "empanada-choclo.jpg" },
        { nombre: "Empanada de jamon y queso", precio: 4875, imagen: "empanada-jyq.jpg" },
        { nombre: "Empanadas calabresa x 3 un", precio: 4190, imagen: "empanada-calabresa.jpg" },
        { nombre: "Empanadas de verdura x 3 un", precio: 4278, imagen: "empanada-verdura.jpg" },
        { nombre: "Empanadas carne dulce x 3 un", precio: 5551, imagen: "empanada-carne-dulce.jpg" },
        { nombre: "Empanadas carne salada x 3 un", precio: 4923, imagen: "Empanadas-carne-salada.jpg" },
        { nombre: "Empanadas de pollo x 3 un", precio: 4713, imagen: "Empanadas-carne-salada.jpg" },
        { nombre: "Empanadas árabes x 3 un", precio: 5656, imagen: "empanada-pirok.jpg" },
        { nombre: "Milanesas de carne x 3 un", precio: 11258, imagen: "Milanesa-carne.jpg" },
        { nombre: "Hamburguesa LP con papas -Pan de papa, carne simple, lechuga, tomate, queso cheddar, bacon, cebolla morada o blanca-", precio: 7447, imagen: "Hamburguesa LP.jpg" },
        { nombre: "Hamburguesa cheddar con papas -Pan de papa, doble carne, cheddar, panceta y cebolla-", precio: 8298, imagen: "Hamburguesa cheddar.jpg" },
        { nombre: "Milanesas de pollo x 3 un", precio: 8344, imagen: "milanesa-pollo.jpg" }
      ]},
      { nombre: "FIAMBRERIA", productos: [
        { nombre: "Picada de fiambres y quesos surtidos LP x 800 grs", precio: 19600, imagen: "picada-surtidos.jpg" },
        { nombre: "Picada de quesos surtidos LP x 500 grs", precio: 12214, imagen: "picada-quesos-500gr.jpg" },
        { nombre: "Picada Lario x 700 grs", precio: 15681, imagen: "picada-Lario.jpg" },
        { nombre: "Queso cremoso María Luisa x 500 grs", precio: 3955, imagen: "queso-cremoso.jpg" },
        { nombre: "Queso barra María Luisa x 500 grs", precio: 4984, imagen: "queso-barra.jpg" },
        { nombre: "Jamón cocido Lario feteado x 500 grs", precio: 11318, imagen: "jamón-cocido-Lario.jpg" },
        { nombre: "Mortadela Paladini x 300 grs", precio: 5153, imagen: "mortadela-Paladini.jpg" }
      ]},
      { nombre: "VERDULERIA", productos: [
        { nombre: "Paquete acelga", precio: 2143, imagen: "acelga.jpg" },
        { nombre: "Cebolla 1Kg", precio: 1056, imagen: "cebolla.jpg" },
        { nombre: "Tomate 1Kg", precio: 7299, imagen: "tomate-redondo.jpg" },
        { nombre: "limón 1Kg", precio: 2677, imagen: "limón.jpg" },
        { nombre: "Bananas 1Kg", precio: 4125, imagen: "banana-ecuador.jpg" }
      ]},
      { nombre: "CARNICERIA", productos: [
        { nombre: "Milanesas de carne 1Kg", precio: 13050, imagen: "milanesas-carne.jpg" },
        { nombre: "Milanesas de pollo 1Kg", precio: 12000, imagen: "milanesas-pollo.jpg" },
        { nombre: "Hamburguesa de carne 1Kg", precio: 14384, imagen: "hamburguesas-carne-comun.jpg" },
        { nombre: "Filet de pechuga 1Kg", precio: 15500, imagen: "filet-pechuga.jpg" },
        { nombre: "Costeletas de cerdo 1Kg", precio: 8391, imagen: "costeletas-cerdo.jpg" },
        { nombre: "Carne picada común 1Kg", precio: 8990, imagen: "carne-picada-comun.jpg" },
        { nombre: "Carne picada especial 1Kg", precio: 14260, imagen: "Carne-picada-especial.jpg" }
      ]},
      { nombre: "ALMACEN", productos: [
        { nombre: "Paté de foie Molto", precio: 957, imagen: "pate-foie-molto.jpg" },
        { nombre: "Puré de tomate Arcor x 520 grs", precio: 1251, imagen: "pure-tomate-Arcor.jpg" },
        { nombre: "Arroz Gallo oro 1Kg", precio: 2909, imagen: "arroz-gallo-oro.jpg" },
        { nombre: "Fideos tallarin Matarazo", precio: 1855, imagen: "tallarin-matarazzo.jpg" },
        { nombre: "Galletitas Surtido Bagley", precio: 3560, imagen: "surtido-bagley.jpg" },
        { nombre: "Yerba Sinceridad 1Kg", precio: 3931, imagen: "yerba-sinceridad.jpg" },
        { nombre: "Aceite Natura 900 ml", precio: 3978, imagen: "aceite-natura.jpg" },
        { nombre: "Azúcar Ledesma 1Kg", precio: 1648, imagen: "azucar-ledesma.jpg" },
        { nombre: "Celusal fina 500 grs", precio: 1368, imagen: "celusal-fina.jpg" }
      ]},
      { nombre: "BEBIDAS", productos: [
        { nombre: "Coca-Cola 1.5L", precio: 3992, imagen: "coca-cola-15.jpg" },
        { nombre: "Coca-Cola 2.5L", precio: 5670, imagen: "coca-cola-25.jpg" },
        { nombre: "Agua mineral Villa del sur levité 1.5L", precio: 2030, imagen: "levite-nar.jpg" },
        { nombre: "Pritty limon 2.25L", precio: 2030, imagen: "pritty-limón.jpg" },
        { nombre: "Vino Otro loco mas", precio: 4736, imagen: "otro-loco-mas.jpg" },
        { nombre: "Vino Finjamos demencia", precio: 4784, imagen: "Finjamos-demencia.jpg" },
        { nombre: "Pepsi 3L", precio: 2987, imagen: "pepsi-3.jpg" },
        { nombre: "Vino Santa Julia chenin dulce", precio: 8233, imagen: "santa-julia-chenin-dulce.jpg" },
        { nombre: "Vino Hormiga negra", precio: 3394, imagen: "hormiga-negra.jpg" },
        { nombre: "Cerveza lata Quilmes 473cc", precio: 1900, imagen: "lata-quilmes.jpg" },
        { nombre: "Cerveza lata Budweiser 473cc", precio: 1818, imagen: "cerveza-lata-budweiser.png" },
        { nombre: "Cerveza botella Corona 333cc", precio: 3230, imagen: "cerveza-corona.jpg" }
      ]},
        { nombre: "LIMPIEZA", productos: [
        { nombre: "Ala liq. Ecolavado DP x 800 ml", precio: 2686, imagen: "ala-liquido.jpg" },
        { nombre: "Suavizante Vivere Esc Prot Clasico x 900 ml", precio: 3050, imagen: "suavizante-vivere.jpg" },
        { nombre: "Lavandina Ayudín triple poder 2 Lts", precio: 3516, imagen: "lavandina-ayudin.jpg" },
        { nombre: "Ala ecolavado x 800 grs", precio: 2704, imagen: "ala-polvo-800.jpg" },
        { nombre: "Ala ecolavado x 400 grs", precio: 1424, imagen: "ala-polvo-400.jpg" },
        { nombre: "Desodorante de pisos Procenex x 900 ml", precio: 1861, imagen: "procenex.jpg" },
        { nombre: "Papel higienico Felpita 4x30 h/simple", precio: 1820, imagen: "felpita.jpg" }
      ]},
      { nombre: "HIGIENE PERSONAL", productos: [
        { nombre: "Shampoo Sedal bomba Argán x 190 ml", precio: 2856, imagen: "sedal-argan-190.jpg " },
        { nombre: "Shampoo Sedal probióticos x 190 ml", precio: 2856, imagen: "sedal-probioticos-190.jpg" },
        { nombre: "Shampoo Sedal colageno x 190 ml", precio: 2856, imagen: "sedal-colageno-190.jpg " },
        { nombre: "Shampoo Sedal ceramidas x 190 ml", precio: 2856, imagen: "sedal-ceramidas-190.jpg" },
        { nombre: "Acondicionador Sedal liso x 190 ml", precio: 2856, imagen: "acondicionador-sedal-liso.jpg" },
        { nombre: "Acondicionador Sedal rizos x 190 ml", precio: 2856, imagen: "acondicionador-sedal-rizos.jpg" },
        { nombre: "Pasta de dientes Colgate x 70 grs", precio: 2561, imagen: "colgate-70.jpg" },
        { nombre: "Cepillo dental Colgate", precio: 1233, imagen: "cepillo-dental-colgate.jpg" },
        { nombre: "Jabón de tocador Plusbelle x 120 grs", precio: 2856, imagen: "jabon-tocador-plusbelle.jpg" }
      ]},
    ];
};

    // Normalizá las rutas de imagen al base definido
    for(const cat in Catalog){
      Catalog[cat] = Catalog[cat].map(p=> ({...p, image: p.image ? (p.image.startsWith('http')? p.image : IMAGE_BASE + p.image) : undefined}));
    }

    // ===== Estado / Carrito =====
    const State = { theme: localStorage.getItem("shop_theme") || "light", cat: Categories[0].id, q:"", sort:"relevance", minp:"", maxp:"" };

    const Cart = {
      key:"shop_cart_v2",
      data: {},
      load(){ try{ this.data = JSON.parse(localStorage.getItem(this.key)) || {} }catch{ this.data = {} }; UI.sync() },
      save(){ localStorage.setItem(this.key, JSON.stringify(this.data)); UI.sync() },
      add(p){ const id=slug(p.name); if(!this.data[id]) this.data[id]={...p, qty:0}; this.data[id].qty++; this.save(); toast("Agregado") },
      dec(id){ if(!this.data[id]) return; this.data[id].qty--; if(this.data[id].qty<=0) delete this.data[id]; this.save() },
      set(id,q){ if(q<=0) delete this.data[id]; else if(this.data[id]) this.data[id].qty=q; this.save() },
      clear(){ this.data={}; this.save() },
      items(){ return Object.values(this.data) },
      count(){ return this.items().reduce((a,b)=>a+b.qty,0) },
      subtotal(){ return this.items().reduce((a,b)=>a+b.price*b.qty,0) }
    };

    // ===== UI =====
    const toast = (msg) => { const t=document.getElementById("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1400) };

    const UI = {
      init(){
        document.documentElement.setAttribute("data-theme", State.theme);
        document.getElementById("themeLabel").textContent = State.theme==="dark" ? "Oscuro" : "Claro";
        this.cats(); this.grid(); this.bind(); Cart.load();
      },
      bind(){
        document.getElementById("themeToggle").onclick = ()=>{ State.theme = State.theme==="dark" ? "light":"dark"; localStorage.setItem("shop_theme", State.theme); document.documentElement.setAttribute("data-theme", State.theme); document.getElementById("themeLabel").textContent = State.theme==="dark" ? "Oscuro" : "Claro"; };
        document.getElementById("q").oninput = e => { State.q = e.target.value.toLowerCase(); this.grid(); };
        document.getElementById("sort").onchange = e => { State.sort = e.target.value; this.grid(); };
        document.getElementById("apply").onclick = ()=>{ State.minp = document.getElementById("minp").value; State.maxp = document.getElementById("maxp").value; this.grid(); };
        document.getElementById("clear").onclick = ()=>{ State.minp=""; State.maxp=""; document.getElementById("minp").value=""; document.getElementById("maxp").value=""; this.grid(); };

        document.getElementById("openCart").onclick = ()=>{ this.renderCart(); document.getElementById("cartModalBg").classList.add("active"); };
        document.getElementById("closeCart").onclick = ()=> document.getElementById("cartModalBg").classList.remove("active");
        document.getElementById("cartModalBg").onclick = function(e){ if(e.target===this) this.classList.remove("active"); };
        document.getElementById("btnClear").onclick = ()=>{ if(confirm("¿Vaciar todo el carrito?")){ Cart.clear(); UI.renderCart(); toast("Carrito vacío"); } };
      },
      cats(){
        const el = document.getElementById("cats"); el.innerHTML="";
        Categories.forEach(c=>{ const b=document.createElement("button"); b.className=(State.cat===c.id?"active":""); b.innerHTML=`<i class="fa-solid ${c.icon}"></i> ${c.name}`; b.onclick=()=>{ State.cat=c.id; this.cats(); this.grid(); }; el.appendChild(b); });
      },
      productsOf(c){ return Catalog[c.id]||[] },
      grid(){
        const wrap = document.getElementById("grid"); wrap.innerHTML="";
        const cats = State.q ? Categories : Categories.filter(c=>c.id===State.cat);
        cats.forEach(c=>{
          const list = this.productsOf(c)
            .filter(p=> !State.q || p.name.toLowerCase().includes(State.q))
            .filter(p=> (State.minp? p.price>=parseInt(State.minp,10):true) && (State.maxp? p.price<=parseInt(State.maxp,10):true))
            .slice();

          if(State.sort==="price_asc") list.sort((a,b)=>a.price-b.price);
          else if(State.sort==="price_desc") list.sort((a,b)=>b.price-a.price);
          else if(State.sort==="alpha") list.sort((a,b)=> a.name.localeCompare(b.name,'es'));

          list.forEach(p=>{
            const key = slug(p.name);
            const card = document.createElement("div"); card.className="card";
            const th = document.createElement("div"); th.className="thumb";
            if(p.image){ const img=document.createElement("img"); img.alt=p.name; img.src=p.image; img.onerror = ()=> { img.src = PLACEHOLDER_IMG }; th.appendChild(img); }
            else{ const img=document.createElement("img"); img.alt=p.name; img.src=PLACEHOLDER_IMG; th.appendChild(img); }
            card.appendChild(th);
            const info = document.createElement("div"); info.className="info";
            info.innerHTML = `<div class="name">${p.name}</div><div class="unit">${p.unit||""}</div><div class="price">${fmt(p.price)}</div>`;
            const acts = document.createElement("div"); acts.className="actions";
            acts.innerHTML = `<div class="qty">
                <div class="icon" data-act="dec" data-key="${key}"><i class="fa-solid fa-minus"></i></div>
                <input class="btn" style="width:60px;text-align:center" value="${Cart.data[key]?.qty||0}" data-act="set" data-key="${key}"/>
                <div class="icon" data-act="inc" data-key="${key}"><i class="fa-solid fa-plus"></i></div>
              </div>`;
            acts.querySelector('[data-act="inc"]').onclick = () => Cart.add(p);
            acts.querySelector('[data-act="dec"]').onclick = () => Cart.dec(key);
            acts.querySelector('[data-act="set"]').onchange = (e)=>{ const q=Math.max(0,parseInt(e.target.value||"0",10)); if(!Cart.data[key] && q>0) Cart.data[key]={...p,qty:0}; Cart.set(key,q); };
            info.appendChild(acts); card.appendChild(info); wrap.appendChild(card);
          });
        });
        this.sync();
      },
      sync(){
        const count = Cart.count(); document.getElementById("cartCount").textContent = count.toLocaleString('es-AR');
        document.getElementById("cartTotal").textContent = fmt(Cart.subtotal());
        document.querySelectorAll('input[data-act="set"][data-key]').forEach(inp=>{ const key = inp.getAttribute("data-key"); inp.value = Cart.data[key]?.qty || 0; });
      },
      renderCart(){
        const list = document.getElementById('cartList'); list.innerHTML = '';
        const items = Cart.items();
        if(items.length===0){ list.innerHTML = '<div style="text-align:center;color:#777;font-style:italic">¡El carrito está vacío!</div>'; document.getElementById('cartTotalModal').textContent=''; document.getElementById('btnWA').style.display='none'; return; }
        let total = 0;
        items.forEach(it=>{
          const id = slug(it.name);
          const sub = it.qty * it.price; total += sub;
          const row = document.createElement('div'); row.className='row';
          row.innerHTML = `
            <span class="row-name">${it.name}</span>
            <span class="row-price">${fmt(it.price)}</span>
            <div class="row-mini">
              <button class="mini" data-id="${id}" data-action="dec">-</button>
              <span id="carr-q-${id}" style="min-width:28px;text-align:center;font-weight:800;color:var(--primary)">${it.qty}</span>
              <button class="mini" data-id="${id}" data-action="inc">+</button>
            </div>
            <span class="row-sub" id="carr-sub-${id}">${fmt(sub)}</span>
            <button class="row-remove" data-id="${id}" data-action="rm">Quitar</button>`;
          list.appendChild(row);
        });
        document.getElementById('cartTotalModal').textContent = `Total: ${fmt(total)}`;
        const msg = this.whatsAppMessage(items, total);
        const phone = WHATSAPP_NUMBER.replace(/\D/g,"");
        const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
        const btn = document.getElementById('btnWA'); btn.href=url; btn.style.display='block';

        // Delegación de eventos para +/-/quitar
        list.onclick = (e)=>{
          const btn = e.target.closest('button'); if(!btn) return; const id = btn.dataset.id; const action = btn.dataset.action; if(!id||!action) return;
          if(action==='dec'){ Cart.dec(id); }
          if(action==='inc'){ if(!Cart.data[id]) return; Cart.data[id].qty++; Cart.save(); }
          if(action==='rm'){ delete Cart.data[id]; Cart.save(); }
          this.renderCart(); this.grid();
        };
      },
      whatsAppMessage(items,total){
        const lines = items.map(it=> `• ${it.name} x${it.qty} – ${fmt(it.price*it.qty)}`);
        return [`*Pedido La Peruana*`,`\n*Detalle:*`,...lines,`\n*Total:* ${fmt(total)}`].join("\n");
      }
    };

    // === Init ===
    UI.init();
  </script>
</body>
</html>
