<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La Peruana â€” Tienda Online</title>
  <meta name="description" content="E-commerce sin backend â€” Tienda online de La Peruana" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <style>
    :root{ --bg:#f8fafc; --card:#ffffff; --muted:#475569; --text:#0f172a; --primary:#e54244; --primary-600:#c12f31; --shadow:0 10px 30px rgba(0,0,0,.10); --radius:18px; --accent:#ffe059; }
    [data-theme="dark"]{ --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e2e8f0; --shadow:0 10px 30px rgba(0,0,0,.35) }
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}

    /* Header */
    header{position:sticky;top:0;z-index:20;backdrop-filter:blur(8px);background:rgba(255,255,255,.9);border-bottom:1px solid rgba(148,163,184,.25)}
    [data-theme="dark"] header{background:rgba(15,23,42,.85)}
    .h-in{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:36px;border-radius:10px}
    .search{position:relative;flex:1;min-width:240px;max-width:520px}
    .search input{width:100%;padding:12px 42px;border-radius:999px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)}
    [data-theme="dark"] .search input{background:#0b1220;border-color:#334155;color:#e2e8f0}
    .search i{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--muted)}
    .btn-lite{border:1px solid rgba(148,163,184,.25);padding:8px 12px;border-radius:999px;display:inline-flex;gap:8px;align-items:center;cursor:pointer;background:#fff;color:var(--text)}
    [data-theme="dark"] .btn-lite{background:#0b1220;border-color:#334155;color:#e2e8f0}

    /* Layout */
    .layout{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:260px 1fr;gap:16px}
    @media(max-width:980px){ .layout{grid-template-columns:1fr} }
    .side{background:var(--card);border:1px solid rgba(148,163,184,.2);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .cats button{width:100%;text-align:left;margin-bottom:6px;padding:10px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#fff;color:var(--text);cursor:pointer}
    .cats button.active{border-color:var(--primary);background:linear-gradient(0deg, rgba(229,66,68,.07), transparent)}
    [data-theme="dark"] .cats button{background:#0b1220;color:#e2e8f0;border-color:#334155}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;align-items:center}
    .toolbar select, .toolbar input{padding:10px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)}
    [data-theme="dark"] .toolbar select, [data-theme="dark"] .toolbar input{background:#0b1220;border-color:#334155;color:#e2e8f0}

    /* Cards */
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.2);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}

    /* ðŸ“· Miniaturas: la imagen define su altura (sin recortes ni altura fija) */
    .thumb{
      width:100%;
      height:auto;        /* <- sin altura fija */
      overflow:visible;   /* permitir crecer */
      background:#f1f5f9;
    }
    .thumb img{
      display:block;
      width:100%;         /* ocupa el ancho de la tarjeta */
      height:auto;        /* conserva proporciÃ³n y muestra TODO */
    }
    [data-theme="dark"] .thumb{background:linear-gradient(135deg, rgba(34,197,94,.12), rgba(6,182,212,.12))}

    .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .name{font-weight:900;line-height:1.15}
    .unit{font-size:12px;color:var(--muted)}
    .price{font-weight:900;margin-top:4px}
    .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:auto}
    .btn{border:1px solid rgba(148,163,184,.25);background:#fff;color:#0f172a;border-radius:10px;padding:10px 12px;cursor:pointer}
    [data-theme="dark"] .btn{background:#0b1220;color:#e2e8f0;border-color:#334155}
    .qty{display:flex;gap:6px;align-items:center}
    .qty .icon{width:34px;height:34px;display:grid;place-items:center;border:1px solid rgba(148,163,184,.25);border-radius:8px;cursor:pointer;background:#fff;color:#0f172a}
    [data-theme="dark"] .qty .icon{background:#0b1220;color:#e2e8f0;border-color:#334155}
    @media (max-width:480px){ .grid{grid-template-columns:repeat(auto-fill,minmax(180px,1fr))} }

    /* Cart FAB + Modal */
    .cart-fab{position:fixed;top:16px;right:16px;background:var(--primary);color:#fff;border:none;border-radius:999px;box-shadow:0 6px 22px rgba(229,66,68,.35);padding:.7em 1.1em;font-size:1.02em;z-index:90;cursor:pointer;display:flex;align-items:center;gap:.6em;font-weight:800}
    .cart-pill{display:inline-flex;background:var(--accent);color:#7a1517;border-radius:999px;font-weight:800;font-size:.93em;padding:.12em .6em;align-items:center;gap:.4em}

    .modal-bg{display:none;position:fixed;z-index:100;inset:0;background:rgba(0,0,0,.35);align-items:center;justify-content:center}
    .modal-bg.active{display:flex}
    .modal{background:var(--card);border-radius:18px;max-width:640px;width:96vw;padding:1.2em .9em .9em .9em;box-shadow:0 10px 40px rgba(0,0,0,.25);position:relative}
    .modal h2{margin:.2em 2.2em .2em 2.2em;color:var(--primary);text-align:center}
    .close{position:absolute;top:.5em;right:.6em;background:transparent;border:none;font-size:1.6em;color:var(--primary-600);cursor:pointer}

    .carrito-list{max-height:320px;overflow-y:auto;margin:.7em 0 .9em;padding:0 .3em}
    .row{display:grid;grid-template-columns:1fr auto auto auto auto;gap:.5em;align-items:center;padding:.55em 0;border-bottom:1px solid rgba(148,163,184,.2)}
    .row-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .row-mini{display:flex;gap:.35em}
    .mini{width:26px;height:26px;border-radius:50%;border:none;background:var(--primary);color:#fff;font-weight:900;cursor:pointer}
    .row-price,.row-sub{text-align:right;min-width:80px}
    .row-remove{border:1px solid rgba(148,163,184,.25);background:#fff;border-radius:10px;padding:.25em .55em;color:#777;cursor:pointer}
    [data-theme="dark"] .row-remove{background:#0b1220;color:#e2e8f0;border-color:#334155}

    .modal-actions{display:flex;gap:.6em;justify-content:space-between;align-items:center;margin-top:.6em}
    .btn-clear{background:#fff;color:#c1121f;border:1px solid #f0b1b5;border-radius:12px;padding:.55em .9em;cursor:pointer;font-weight:800}
    .total{font-weight:900;color:var(--primary);font-size:1.14em;flex:1;text-align:right}

    .btn-wa{display:block;width:100%;background:#25D366;color:#fff;font-weight:900;border:none;border-radius:24px;padding:.8em 0;font-size:1.08em;text-decoration:none;cursor:pointer;margin-top:.4em;box-shadow:0 4px 18px rgba(37,211,102,.35);text-align:center}
    .btn-wa[disabled]{opacity:.6;pointer-events:none}

    .toast{position:fixed;right:12px;bottom:12px;background:#052e16;color:#bbf7d0;border:1px solid #166534;padding:10px 12px;border-radius:10px;display:none;z-index:1000}
    .toast.show{display:block}

    /* Paso 2: formulario */
    .step{display:block}
    .hidden{display:none !important}
    .form{display:grid;gap:.8em;margin:.4em 0}
    .form .row-2{display:grid;grid-template-columns:1fr;gap:.8em}
    @media(min-width:520px){ .form .row-2{grid-template-columns:1fr 1fr} }
    .form label{font-size:.92em;color:var(--muted)}
    .form input,.form textarea{
      width:100%;padding:.75em .9em;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)
    }
    [data-theme="dark"] .form input,[data-theme="dark"] .form textarea{background:#0b1220;border-color:#334155;color:#e2e8f0}
    .error{color:#b91c1c;font-size:.9em;margin-top:-.4em}
  </style>
</head>
<body>
  <header>
    <div class="h-in">
      <div class="brand">
        <img src="https://raw.githubusercontent.com/la-peruana/laperuana/main/LOGO-LA-PERUANA.jpg" alt="La Peruana" />
        <strong>La Peruana</strong>
      </div>
      <div class="search">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="q" placeholder="Buscar (ej: medialuna, sandwich, quesoâ€¦)"/>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn-lite" id="themeToggle"><i class="fa-solid fa-moon"></i> <span id="themeLabel">Claro</span></button>
      </div>
    </div>
  </header>

  <button class="cart-fab" id="openCart"><i class="fa-solid fa-cart-shopping"></i><span>Carrito</span> <span class="cart-pill"><span id="cartCount">0</span> â€¢ <span id="cartTotal">$0</span></span></button>

  <div class="layout">
    <aside class="side">
      <h3>CategorÃ­as</h3>
      <div id="cats" class="cats"></div>
      <hr style="border-color:rgba(148,163,184,.2)">
      <h3>Filtros</h3>
      <div class="toolbar">
        <select id="sort">
          <option value="relevance">Relevancia</option>
          <option value="price_asc">Precio â†‘</option>
          <option value="price_desc">Precio â†“</option>
          <option value="alpha">Aâ€“Z</option>
        </select>
        <input id="minp" placeholder="Precio min" inputmode="numeric">
        <input id="maxp" placeholder="Precio max" inputmode="numeric">
        <button class="btn" id="apply">Aplicar</button>
        <button class="btn" id="clear">Limpiar</button>
      </div>
    </aside>

    <main>
      <div class="grid" id="grid"></div>
    </main>
  </div>

  <!-- Modal Carrito + Paso 2 (Datos) -->
  <div class="modal-bg" id="cartModalBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <button class="close" id="closeCart" title="Cerrar" aria-label="Cerrar">&times;</button>
      <h2 id="cartTitle">Tu Carrito</h2>

      <!-- Paso 1: Carrito -->
      <div id="cartStep" class="step">
        <div class="carrito-list" id="cartList"></div>
        <div class="modal-actions">
          <button class="btn-clear" id="btnClear">Eliminar todo</button>
          <div class="total" id="cartTotalModal"></div>
        </div>
        <button class="btn-wa" id="btnContinue">Continuar</button>
      </div>

      <!-- Paso 2: Datos personales -->
      <div id="detailsStep" class="step hidden" aria-live="polite">
        <div class="form">
          <div class="row-2">
            <div>
              <label for="custName">Nombre y apellido</label>
              <input id="custName" autocomplete="name" placeholder="Ej: Juan PÃ©rez">
              <div id="errName" class="error" style="display:none">IngresÃ¡ tu nombre y apellido.</div>
            </div>
            <div>
              <label for="custAddress">Domicilio de entrega</label>
              <input id="custAddress" autocomplete="street-address" placeholder="Calle, nÃºmero, barrio">
              <div id="errAddress" class="error" style="display:none">IngresÃ¡ tu domicilio.</div>
            </div>
          </div>
          <div>
            <label for="custNotes">Notas (opcional)</label>
            <textarea id="custNotes" rows="2" placeholder="Indicaciones adicionales, horario, timbre, etc."></textarea>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-clear" id="btnBack">Volver</button>
          <div class="total" id="cartTotalModal2"></div>
        </div>
        <a class="btn-wa" id="btnWA" target="_blank" rel="noopener" aria-disabled="true">Enviar por WhatsApp</a>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Agregado al carrito</div>

  <script>
    // ===== Config =====
    const IMAGE_BASE = "https://raw.githubusercontent.com/la-peruana/laperuana/main/"; // raÃ­z del repo
    const WHATSAPP_NUMBER = "5493435075991"; // sin + ni espacios

    // ===== Utilidades =====
    const CURRENCY = new Intl.NumberFormat("es-AR", {style:"currency", currency:"ARS", maximumFractionDigits:0});
    const fmt = n => CURRENCY.format(n);
    const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
    const PLACEHOLDER_IMG = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='%23f1f5f9'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%2394a3b8' font-size='28' font-family='Arial'>Imagen</text></svg>";

    // ===== CategorÃ­as =====
    const Categories = [
      { id:"rotiseria",   name:"RotiserÃ­a",        icon:"fa-utensils" },
      { id:"panaderia",   name:"PanaderÃ­a",        icon:"fa-bread-slice" },
      { id:"pasteleria",  name:"PastelerÃ­a",       icon:"fa-cake-candles" },
      { id:"carniceria",  name:"CarnicerÃ­a",       icon:"fa-drumstick-bite" },
      { id:"verduleria",  name:"VerdulerÃ­a",       icon:"fa-carrot" },
      { id:"fiambreria",  name:"FiambrerÃ­a",       icon:"fa-cheese" },
      { id:"almacen",     name:"AlmacÃ©n",          icon:"fa-boxes-stacked" },
      { id:"bebidas",     name:"Bebidas",          icon:"fa-champagne-glasses" },
      { id:"limpieza",    name:"Limpieza",         icon:"fa-soap" },
      { id:"higiene",     name:"Higiene personal", icon:"fa-pump-soap" }
    ];

    // ===== CatÃ¡logo =====
    const Catalog = {
      panaderia: [
        { name: "Facturas con crema x 3 un", price: 2177, image: "facturas-crema.jpg" },
        { name: "Facturas con crema y membrillo x 3 un", price: 2613, image: "facturas-crema-membrillo.jpg" },
        { name: "Facturas con crema y dulce de leche x 3 un", price: 1960, image: "facturas-crema-ddl.jpg" },
        { name: "Medialunas con dulce de leche x 3 un", price: 2449, image: "medialuna-ddl.jpg" },
        { name: "Medialunas dulces x 3 un", price: 1851, image: "medialuna-dulce.jpg" },
        { name: "Vigilantes de batata x 3 un", price: 2504, image: "vigilantes-batata.jpg" },
        { name: "Vigilantes de membrillo x 3 un", price: 2308, image: "vigilantes-membrillo.jpg" },
        { name: "Bollitos con crema x 3 un", price: 2068, image: "bollitos-crema.jpg" },
        { name: "Bollitos con dulce de leche x 3 un", price: 1960, image: "bollitos-ddl.jpg" },
        { name: "Empanaditas de dulce de leche x 3 un", price: 1415, image: "empanaditas-ddl.jpg" },
        { name: "Pirulines x 3 un", price: 2177, image: "pirulines.jpg" },
        { name: "Borrachitos x 3 un", price: 1960, image: "borrachitos.jpg" },
        { name: "Medialunas marplatenses x 3 un", price: 1933, image: "medialunas-marplatenses.jpg" },
        { name: "Especiales x 250grs", price: 2363, image: "especiales.jpg" },
        { name: "Pan francÃ©s x 250grs", price: 740, image: "pan-frances.jpg" },
        { name: "Galleta de campo x 250grs", price: 840, image: "galleta-campo.jpg" },
        { name: "Galleta hojaldrada x 250grs", price: 1018, image: "galleta-hojaldrada.jpg" },
        { name: "Suizos x 250grs", price: 3319, image: "suizos.jpg" },
        { name: "Medialunas saladas grandes x 250grs", price: 3281, image: "medialuna-salada-grande.jpg" },
        { name: "Medialunas saladas chicas x 250grs", price: 4024, image: "medialuna-salada-chica.jpg" },
        { name: "Croissant x 1 un", price: 2464, image: "Croissant.jpg" }
      ],
      pasteleria: [
        { name: "Cheesecake individual", price: 6362, image: "cheesecake-individual.jpg" },
        { name: "Torta mini bombÃ³n", price: 1019, image: "torta-mini-bombon.jpg" },
        { name: "Torta mini lemon pie", price: 1019, image: "torta-mini-lemonpie.jpg" },
        { name: "Torta mini frutal", price: 1551, image: "torta-mini-frutal.jpg" },
        { name: "Lingote de durazno", price: 2038, image: "lingote-durazno.jpg" },
        { name: "Lingote de frutilla", price: 2038, image: "lingote-frutilla.jpg" },
        { name: "Red Velvet individual", price: 1699, image: "red-velvet.jpg" },
        { name: "TiramisÃº individual", price: 3057, image: "tiramisu-individual.jpg" },
        { name: "Masas finas x 7 un", price: 7427, image: "masas-finas.jpg" },
        { name: "Alfajores de maicena grandes x 2 un", price: 1362, image: "alfajor-maicena-grande.jpg" },
        { name: "Alfajores de maicena medianos x 3 un", price: 1424, image: "alfa-maicena-med.jpg" },
        { name: "Alfajores de maicena mini x 5 un", price: 1485, image: "alfajor-maicena-grande.jpg" },
        { name: "Alfajores de chocolate grande x 2 un", price: 1820, image: "alfajor-choco-gr.jpg" },
        { name: "Alfajores de chocolate mediano x 3 un", price: 1903, image: "alfajor-choco-med.jpg" },
        { name: "Alfajores de chocolate mini x 5 un", price: 1986, image: "alfajor-choco-mini.jpg" }
      ],
      rotiseria: [
        { name: "Torrejas de arroz x 3 un", price: 1225, image: "torrejas-arroz.jpg" },
        { name: "Torrejas de acelga x 3 un", price: 1225, image: "torrejas-acelga.jpg" },
        { name: "Bandeja de sÃ¡ndwich de miga simple x 6 un", price: 12846, image: "SÃ¡ndwich-simples.jpg" },
        { name: "Bandeja de sÃ¡ndwich de miga triples x 6 un", price: 13588, image: "sÃ¡ndwiches-triples.jpg" },
        { name: "Tarta de pollo -porciÃ³n-", price: 7096, image: "tarta-pollo.jpg" },
        { name: "Tortilla de acelga -porciÃ³n-", price: 4863, image: "Tortilla-acelga.jpg" },
        { name: "Tortilla de verduras -porciÃ³n-", price: 4863, image: "Tortilla-verduras.jpg" },
        { name: "Terrina acelga -porciÃ³n-", price: 3633, image: "Terrina-acelga.jpg" },
        { name: "Terrina verdura -porciÃ³n-", price: 3633, image: "Terrina-verduras.JPG" },
        { name: "Papas fritas -porciÃ³n-", price: 2591, image: "papas-fritas.jpg" },
        { name: "Patamuslo x 2 un", price: 13196, image: "pata-muslo-asada.jpg" },
        { name: "SÃ¡ndwich milanesa de pollo", price: 5637, image: "SÃ¡ndwich-milanesa.jpg" },
        { name: "SÃ¡ndwich milanesa de carne simple", price: 8176, image: "sandwich-mila-carne.jpg" },
        { name: "SÃ¡ndwich milanesa de carne completo", price: 9638, image: "sandwich-mila-carne-completo.jpg" },
        { name: "Pebete de jamÃ³n y queso", price: 3192, image: "Pebete.jpg" },
        { name: "Empanadas de choclo x 3 un", price: 6168, image: "empanadas-choclo.jpg" },
        { name: "Empanada de jamÃ³n y queso", price: 4875, image: "empanadas-jamÃ³n-queso.jpg" },
        { name: "Empanadas calabresa x 3 un", price: 4190, image: "empanadas-calabresa.jpg" },
        { name: "Empanadas de verdura x 3 un", price: 4278, image: "empanadas-verdura.jpg" },
        { name: "Empanadas carne dulce x 3 un", price: 5551, image: "empanadas-carne dulce.jpg" },
        { name: "Empanadas carne salada x 3 un", price: 4923, image: "Empanadas-carne-salada.jpg" },
        { name: "Empanadas de pollo x 3 un", price: 4713, image: "Empanadas-carne-salada.jpg" },
        { name: "Empanadas Ã¡rabes x 3 un", price: 5656, image: "empanadas-pirok.jpg" },
        { name: "Milanesas de carne x 3 un", price: 11258, image: "Milanesa-carne.jpg" },
        { name: "Hamburguesa LP con papas", price: 7447, image: "hambur-lp.jpg" },
        { name: "Hamburguesa cheddar con papas", price: 8298, image: "hambur-cheddar.jpg" },
        { name: "Milanesas de pollo x 3 un", price: 8344, image: "Milanesa-pollo.jpg" }
      ],
      fiambreria: [
        { name: "Picada de fiambres y quesos surtidos LP x 800 grs", price: 19600, image: "picada-surtidos.jpg" },
        { name: "Picada de quesos surtidos LP x 500 grs", price: 12214, image: "picada-quesos-500gr.jpg" },
        { name: "Picada Lario x 700 grs", price: 15681, image: "picada-Lario.jpg" },
        { name: "Queso cremoso MarÃ­a Luisa x 500 grs", price: 3955, image: "queso-cremoso.jpg" },
        { name: "Queso barra MarÃ­a Luisa x 500 grs", price: 4984, image: "queso-barra.jpg" },
        { name: "JamÃ³n cocido Lario feteado x 500 grs", price: 11318, image: "jamÃ³n-cocido-Lario.jpg" },
        { name: "Mortadela Paladini x 300 grs", price: 5153, image: "mortadela-Paladini.jpg" }
      ],
      verduleria: [
        { name: "Paquete acelga", price: 2143, image: "acelga.jpg" },
        { name: "Cebolla 1Kg", price: 1056, image: "cebolla.jpg" },
        { name: "Tomate 1Kg", price: 7299, image: "tomate-redondo.jpg" },
        { name: "LimÃ³n 1Kg", price: 2677, image: "limÃ³n.jpg" },
        { name: "Bananas 1Kg", price: 4125, image: "banana-ecuador.jpg" }
      ],
      carniceria: [
        { name: "Milanesas de carne 1Kg", price: 13050, image: "milanesas-carne.jpg" },
        { name: "Milanesas de pollo 1Kg", price: 12000, image: "milanesas-pollo.jpg" },
        { name: "Hamburguesa de carne 1Kg", price: 14384, image: "hamburguesas-carne-comun.jpg" },
        { name: "Filet de pechuga 1Kg", price: 15500, image: "filet-pechuga.jpg" },
        { name: "Costeletas de cerdo 1Kg", price: 8391, image: "costeletas-cerdo.jpg" },
        { name: "Carne picada comÃºn 1Kg", price: 8990, image: "carne-picada-comun.jpg" },
        { name: "Carne picada especial 1Kg", price: 14260, image: "Carne-picada-especial.jpg" }
      ],
      almacen: [
        { name: "PatÃ© de foie Molto", price: 957, image: "pate-foie-molto.jpg" },
        { name: "PurÃ© de tomate Arcor x 520 grs", price: 1251, image: "pure-tomate-Arcor.jpg" },
        { name: "Arroz Gallo oro 1Kg", price: 2909, image: "arroz-gallo-oro.jpg" },
        { name: "Fideos tallarÃ­n Matarazzo", price: 1855, image: "tallarin-matarazzo.jpg" },
        { name: "Galletitas Surtido Bagley", price: 3560, image: "surtido-bagley.jpg" },
        { name: "Yerba Sinceridad 1Kg", price: 3931, image: "yerba-sinceridad.jpg" },
        { name: "Aceite Natura 900 ml", price: 3978, image: "aceite-natura.jpg" },
        { name: "AzÃºcar Ledesma 1Kg", price: 1648, image: "azucar-ledesma.jpg" },
        { name: "Celusal fina 500 grs", price: 1368, image: "celusal-fina.jpg" }
      ],
      bebidas: [
        { name: "Coca-Cola 1.5L", price: 3992, image: "coca-cola-15.jpg" },
        { name: "Coca-Cola 2.5L", price: 5670, image: "coca-cola-25.jpg" },
        { name: "Agua mineral Villa del Sur LevitÃ© 1.5L", price: 2030, image: "agua-sab-levite.jpg" },
        { name: "Pritty limÃ³n 2.25L", price: 2030, image: "pritty-limÃ³n.jpg" },
        { name: "Vino Otro loco mÃ¡s", price: 4736, image: "otro-loco-mas.jpg" },
        { name: "Vino Finjamos demencia", price: 4784, image: "Finjamos-demencia.jpg" },
        { name: "Pepsi 3L", price: 2987, image: "pepsi-3.jpg" },
        { name: "Vino Santa Julia chenin dulce", price: 8233, image: "santa-julia-chenin-dulce.jpg" },
        { name: "Vino Hormiga negra", price: 3394, image: "hormiga-negra.jpg" },
        { name: "Cerveza lata Quilmes 473cc", price: 1900, image: "lata-quilmes.jpg" },
        { name: "Cerveza lata Budweiser 473cc", price: 1818, image: "lata-budweiser.png" },
        { name: "Cerveza botella Corona 333cc", price: 3230, image: "cerveza-corona.jpg" }
      ],
      limpieza: [
        { name: "Ala liq. Ecolavado DP x 800 ml", price: 2686, image: "ala-liquido.jpg" },
        { name: "Suavizante Vivere Esc Prot ClÃ¡sico x 900 ml", price: 3050, image: "suavizante-vivere.jpg" },
        { name: "Lavandina AyudÃ­n triple poder 2 Lts", price: 3516, image: "lavandina-ayudin.jpg" },
        { name: "Ala ecolavado x 800 grs", price: 2704, image: "ala-polvo-800.jpg" },
        { name: "Ala ecolavado x 400 grs", price: 1424, image: "ala-polvo-400.jpg" },
        { name: "Desodorante de pisos Procenex x 900 ml", price: 1861, image: "procenex.jpg" },
        { name: "Papel higiÃ©nico Felpita 4x30 h/simple", price: 1820, image: "felpita.jpg" }
      ],
      higiene: [
        { name: "Shampoo Sedal bomba ArgÃ¡n x 190 ml", price: 2856, image: "sedal-argan-190.jpg" },
        { name: "Shampoo Sedal probiÃ³ticos x 190 ml", price: 2856, image: "sedal-probioticos-190.jpg" },
        { name: "Shampoo Sedal colÃ¡geno x 190 ml", price: 2856, image: "sedal-colageno-190.jpg" },
        { name: "Shampoo Sedal ceramidas x 190 ml", price: 2856, image: "sedal-ceramidas-190.jpg" },
        { name: "Acondicionador Sedal liso x 190 ml", price: 2856, image: "acondicionador-sedal-liso.jpg" },
        { name: "Acondicionador Sedal rizos x 190 ml", price: 2856, image: "acondicionador-sedal-rizos.jpg" },
        { name: "Pasta de dientes Colgate x 70 grs", price: 2561, image: "colgate-70.jpg" },
        { name: "Cepillo dental Colgate", price: 1233, image: "cepillo-dental-colgate.jpg" },
        { name: "JabÃ³n de tocador Plusbelle x 120 grs", price: 2856, image: "jabon-tocador-plusbelle.jpg" }
      ]
    };

    // Normalizar rutas de imagen (encode nombres con espacios/acentos)
    Object.keys(Catalog).forEach(k=>{
      Catalog[k] = Catalog[k].map(p => ({
        ...p,
        image: p.image
          ? (p.image.startsWith('http')
              ? p.image
              : IMAGE_BASE + encodeURIComponent(p.image))
          : undefined
      }));
    });

    // ===== Estado / Carrito / Usuario =====
    const State = { theme: localStorage.getItem("shop_theme") || "light", cat: Categories[0].id, q:"", sort:"relevance", minp:"", maxp:"" };

    const User = {
      key: "shop_user_v1",
      data: { name:"", address:"", notes:"" },
      load(){
        try { const v = JSON.parse(localStorage.getItem(this.key));
          if(v && typeof v==='object') this.data = {...this.data, ...v};
        } catch {}
      },
      save(partial){
        this.data = {...this.data, ...partial};
        localStorage.setItem(this.key, JSON.stringify(this.data));
      }
    };

    const Cart = {
      key:"shop_cart_v2",
      data: {},
      load(){ try{ this.data = JSON.parse(localStorage.getItem(this.key)) || {} }catch{ this.data = {} }; UI.sync() },
      save(){ localStorage.setItem(this.key, JSON.stringify(this.data)); UI.sync() },
      add(p){ const id=slug(p.name); if(!this.data[id]) this.data[id]={...p, qty:0}; this.data[id].qty++; this.save(); toast("Agregado") },
      dec(id){ if(!this.data[id]) return; this.data[id].qty--; if(this.data[id].qty<=0) delete this.data[id]; this.save() },
      set(id,q){ if(q<=0) delete this.data[id]; else if(this.data[id]) this.data[id].qty=q; this.save() },
      clear(){ this.data={}; this.save() },
      items(){ return Object.values(this.data) },
      count(){ return this.items().reduce((a,b)=>a+b.qty,0) },
      subtotal(){ return this.items().reduce((a,b)=>a+b.price*b.qty,0) }
    };

    // ===== UI =====
    const toast = (msg) => { const t=document.getElementById("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1400) };

    const UI = {
      step: "cart", // "cart" | "details"
      init(){
        User.load();
        document.documentElement.setAttribute("data-theme", State.theme);
        document.getElementById("themeLabel").textContent = State.theme==="dark" ? "Oscuro" : "Claro";
        this.cats(); this.grid(); this.bind(); Cart.load();
      },
      bind(){
        document.getElementById("themeToggle").onclick = ()=>{ State.theme = State.theme==="dark" ? "light":"dark"; localStorage.setItem("shop_theme", State.theme); document.documentElement.setAttribute("data-theme", State.theme); document.getElementById("themeLabel").textContent = State.theme==="dark" ? "Oscuro" : "Claro"; };
        document.getElementById("q").oninput = e => { State.q = e.target.value.toLowerCase(); this.grid(); };
        document.getElementById("sort").onchange = e => { State.sort = e.target.value; this.grid(); };
        document.getElementById("apply").onclick = ()=>{ State.minp = document.getElementById("minp").value; State.maxp = document.getElementById("maxp").value; this.grid(); };
        document.getElementById("clear").onclick = ()=>{ State.minp=""; State.maxp=""; document.getElementById("minp").value=""; document.getElementById("maxp").value=""; this.grid(); };

        document.getElementById("openCart").onclick = ()=>{ this.step="cart"; this.renderCart(); this.showStep(); document.getElementById("cartModalBg").classList.add("active"); };
        document.getElementById("closeCart").onclick = ()=> document.getElementById("cartModalBg").classList.remove("active");
        document.getElementById("cartModalBg").onclick = function(e){ if(e.target===this) this.classList.remove("active"); };
        document.getElementById("btnClear").onclick = ()=>{ if(confirm("Â¿Vaciar todo el carrito?")){ Cart.clear(); UI.renderCart(); toast("Carrito vacÃ­o"); } };

        document.getElementById("btnContinue").onclick = ()=> {
          if (Cart.items().length===0) { toast("El carrito estÃ¡ vacÃ­o"); return; }
          this.step="details";
          this.renderDetails();
          this.showStep();
        };
        document.getElementById("btnBack").onclick = ()=> { this.step="cart"; this.showStep(); };

        // Autoguardado + actualizaciÃ³n del link de WhatsApp
        const bindSave = (id, key) => {
          const el = document.getElementById(id);
          el.addEventListener('input', () => {
            const value = el.value; // guardamos mientras escribe
            User.save({ [key]: value });
            this.updateWA();
          });
        };
        bindSave("custName","name");
        bindSave("custAddress","address");
        bindSave("custNotes","notes");
      },
      showStep(){
        const cartStep = document.getElementById("cartStep");
        const detailsStep = document.getElementById("detailsStep");
        const title = document.getElementById("cartTitle");
        if(this.step==="cart"){
          cartStep.classList.remove("hidden");
          detailsStep.classList.add("hidden");
          title.textContent = "Tu Carrito";
        }else{
          cartStep.classList.add("hidden");
          detailsStep.classList.remove("hidden");
          title.textContent = "Datos para el pedido";
        }
      },
      cats(){
        const el = document.getElementById("cats"); el.innerHTML="";
        Categories.forEach(c=>{ const b=document.createElement("button"); b.className=(State.cat===c.id?"active":""); b.innerHTML=`<i class="fa-solid ${c.icon}"></i> ${c.name}`; b.onclick=()=>{ State.cat=c.id; this.cats(); this.grid(); }; el.appendChild(b); });
      },
      productsOf(c){ return Catalog[c.id] || [] },
      grid(){
        const wrap = document.getElementById("grid"); wrap.innerHTML="";
        const cats = State.q ? Categories : Categories.filter(c=>c.id===State.cat);
        cats.forEach(c=>{
          const list = this.productsOf(c)
            .filter(p=> !State.q || p.name.toLowerCase().includes(State.q))
            .filter(p=> (State.minp? p.price>=parseInt(State.minp,10):true) && (State.maxp? p.price<=parseInt(State.maxp,10):true))
            .slice();

          if(State.sort==="price_asc") list.sort((a,b)=>a.price-b.price);
          else if(State.sort==="price_desc") list.sort((a,b)=>b.price-a.price);
          else if(State.sort==="alpha") list.sort((a,b)=> a.name.localeCompare(b.name,'es'));

          list.forEach(p=>{
            const key = slug(p.name);
            const card = document.createElement("div"); card.className="card";
            const th = document.createElement("div"); th.className="thumb";
            const img=document.createElement("img");
            img.alt=p.name; img.loading="lazy"; img.decoding="async";
            img.src=p.image || PLACEHOLDER_IMG;
            img.onerror = ()=> { console.warn("No carga la imagen:", img.src); img.src = PLACEHOLDER_IMG; };
            th.appendChild(img); card.appendChild(th);

            const info = document.createElement("div"); info.className="info";
            info.innerHTML = `<div class="name">${p.name}</div><div class="unit">${p.unit||""}</div><div class="price">${fmt(p.price)}</div>`;
            const acts = document.createElement("div"); acts.className="actions";
            acts.innerHTML = `<div class="qty">
                <div class="icon" data-act="dec" data-key="${key}"><i class="fa-solid fa-minus"></i></div>
                <input class="btn" style="width:60px;text-align:center" value="${Cart.data[key]?.qty||0}" data-act="set" data-key="${key}" readonly/>
                <div class="icon" data-act="inc" data-key="${key}"><i class="fa-solid fa-plus"></i></div>
              </div>`;
            acts.querySelector('[data-act="inc"]').onclick = () => Cart.add(p);
            acts.querySelector('[data-act="dec"]').onclick = () => Cart.dec(key);
            info.appendChild(acts); card.appendChild(info); wrap.appendChild(card);
          });
        });
        this.sync();
      },
      sync(){
        const count = Cart.count(); document.getElementById("cartCount").textContent = count.toLocaleString('es-AR');
        document.getElementById("cartTotal").textContent = fmt(Cart.subtotal());
        document.querySelectorAll('input[data-act="set"][data-key]').forEach(inp=>{ const key = inp.getAttribute("data-key"); inp.value = Cart.data[key]?.qty || 0; });
      },
      renderCart(){
        const list = document.getElementById('cartList'); list.innerHTML = '';
        const items = Cart.items();
        const btnContinue = document.getElementById('btnContinue');
        if(items.length===0){
          list.innerHTML = '<div style="text-align:center;color:#777;font-style:italic">Â¡El carrito estÃ¡ vacÃ­o!</div>';
          document.getElementById('cartTotalModal').textContent='';
          btnContinue.disabled = true;
          return;
        }
        btnContinue.disabled = false;
        let total = 0;
        items.forEach(it=>{
          const id = slug(it.name);
          const sub = it.qty * it.price; total += sub;
          const row = document.createElement('div'); row.className='row';
          row.innerHTML = `
            <span class="row-name">${it.name}</span>
            <span class="row-price">${fmt(it.price)}</span>
            <div class="row-mini">
              <button class="mini" data-id="${id}" data-action="dec">-</button>
              <span id="carr-q-${id}" style="min-width:28px;text-align:center;font-weight:800;color:var(--primary)">${it.qty}</span>
              <button class="mini" data-id="${id}" data-action="inc">+</button>
            </div>
            <span class="row-sub" id="carr-sub-${id}">${fmt(sub)}</span>
            <button class="row-remove" data-id="${id}" data-action="rm">Quitar</button>`;
          list.appendChild(row);
        });
        document.getElementById('cartTotalModal').textContent = `Total: ${fmt(total)}`;

        // DelegaciÃ³n de eventos para +/-/quitar
        list.onclick = (e)=>{
          const btn = e.target.closest('button'); if(!btn) return; const id = btn.dataset.id; const action = btn.dataset.action; if(!id||!action) return;
          if(action==='dec'){ Cart.dec(id); }
          if(action==='inc'){ if(!Cart.data[id]) return; Cart.data[id].qty++; Cart.save(); }
          if(action==='rm'){ delete Cart.data[id]; Cart.save(); }
          this.renderCart(); this.grid();
        };
      },
      renderDetails(){
        // Prefill desde localStorage
        document.getElementById('custName').value = User.data.name || "";
        document.getElementById('custAddress').value = User.data.address || "";
        document.getElementById('custNotes').value = User.data.notes || "";
        document.getElementById('cartTotalModal2').textContent = `Total: ${fmt(Cart.subtotal())}`;
        this.updateWA();
      },
      getUser(){
        const name = (document.getElementById('custName').value || "").trim();
        const address = (document.getElementById('custAddress').value || "").trim();
        const notes = (document.getElementById('custNotes').value || "").trim();
        return {name,address,notes};
      },
      validateUser(){
        const {name,address} = this.getUser();
        let ok = true;
        const errN = document.getElementById('errName');
        const errA = document.getElementById('errAddress');
        if(!name){ errN.style.display='block'; ok=false; } else { errN.style.display='none'; }
        if(!address){ errA.style.display='block'; ok=false; } else { errA.style.display='none'; }
        return ok;
      },
      whatsAppMessage(items,total,user){
        const lines = items.map(it=> `â€¢ ${it.name} x${it.qty} â€“ ${fmt(it.price*it.qty)}`);
        const head = [`*Pedido La Peruana*`];
        const datos = [
          `\n*Datos del cliente*`,
          `â€¢ Nombre: ${user.name}`,
          `â€¢ Domicilio: ${user.address}`,
          user.notes ? `â€¢ Notas: ${user.notes}` : null
        ].filter(Boolean);
        return [...head, `\n*Detalle:*`, ...lines, `\n*Total:* ${fmt(total)}`, `\n`, ...datos].join("\n");
      },
      updateWA(){
        const btn = document.getElementById('btnWA');
        const userOk = this.validateUser();
        btn.setAttribute('aria-disabled', userOk ? 'false' : 'true');
        if(!userOk){
          btn.setAttribute('disabled','disabled');
          btn.removeAttribute('href');
          return;
        }
        btn.removeAttribute('disabled');
        const items = Cart.items();
        const total = Cart.subtotal();
        const msg = this.whatsAppMessage(items, total, this.getUser());
        const phone = WHATSAPP_NUMBER.replace(/\D/g,"");
        const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
        btn.href = url;
      }
    };

    // === Init ===
    UI.init();
  </script>
</body>
</html>
