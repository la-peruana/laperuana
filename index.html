<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La Peruana — Tienda Online</title>
  <meta name="description" content="E‑commerce sin backend — Tienda online de La Peruana" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <style>
    :root{ --bg:#f8fafc; --card:#ffffff; --muted:#475569; --text:#0f172a; --primary:#e54244; --primary-600:#c12f31; --shadow:0 10px 30px rgba(0,0,0,.10); --radius:18px; --accent:#ffe059; }
    [data-theme="dark"]{ --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e2e8f0; --shadow:0 10px 30px rgba(0,0,0,.35) }
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}

    /* Header */
    header{position:sticky;top:0;z-index:20;backdrop-filter:blur(8px);background:rgba(255,255,255,.9);border-bottom:1px solid rgba(148,163,184,.25)}
    [data-theme="dark"] header{background:rgba(15,23,42,.85)}
    .h-in{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:36px;border-radius:10px}
    .search{position:relative;flex:1;min-width:240px;max-width:520px}
    .search input{width:100%;padding:12px 42px;border-radius:999px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)}
    [data-theme="dark"] .search input{background:#0b1220;border-color:#334155;color:#e2e8f0}
    .search i{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--muted)}
    .toggle,.btn-lite{border:1px solid rgba(148,163,184,.25);padding:8px 12px;border-radius:999px;display:inline-flex;gap:8px;align-items:center;cursor:pointer;background:#fff;color:var(--text)}
    [data-theme="dark"] .toggle,[data-theme="dark"] .btn-lite{background:#0b1220;border-color:#334155;color:#e2e8f0}

    /* Layout */
    .layout{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:260px 1fr;gap:16px}
    @media(max-width:980px){ .layout{grid-template-columns:1fr} }
    .side{background:var(--card);border:1px solid rgba(148,163,184,.2);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .cats button{width:100%;text-align:left;margin-bottom:6px;padding:10px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#fff;color:var(--text);cursor:pointer}
    .cats button.active{border-color:var(--primary);background:linear-gradient(0deg, rgba(229,66,68,.07), transparent)}
    [data-theme="dark"] .cats button{background:#0b1220;color:#e2e8f0;border-color:#334155}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;align-items:center}
    .toolbar select, .toolbar input{padding:10px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text)}
    [data-theme="dark"] .toolbar select, [data-theme="dark"] .toolbar input{background:#0b1220;border-color:#334155;color:#e2e8f0}

    /* Cards */
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.2);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .thumb{height:150px;background:#f1f5f9;display:grid;place-items:center;color:#e11d48;font-size:26px;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    [data-theme="dark"] .thumb{background:linear-gradient(135deg, rgba(34,197,94,.12), rgba(6,182,212,.12))}
    .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .name{font-weight:900;line-height:1.15}
    .unit{font-size:12px;color:var(--muted)}
    .price{font-weight:900}
    .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:auto}
    .btn{border:1px solid rgba(148,163,184,.25);background:#fff;color:var(--text);border-radius:10px;padding:10px 12px;cursor:pointer}
    [data-theme="dark"] .btn{background:#0b1220;color:#e2e8f0;border-color:#334155}
    .qty{display:flex;gap:6px;align-items:center}
    .qty .icon{width:34px;height:34px;display:grid;place-items:center;border:1px solid rgba(148,163,184,.25);border-radius:8px;cursor:pointer;background:#fff;color:var(--text)}
    [data-theme="dark"] .qty .icon{background:#0b1220;color:#e2e8f0;border-color:#334155}

    /* Cart FAB + Modal */
    .cart-fab{position:fixed;top:16px;right:16px;background:var(--primary);color:#fff;border:none;border-radius:999px;box-shadow:0 6px 22px rgba(229,66,68,.35);padding:.7em 1.1em;font-size:1.02em;z-index:90;cursor:pointer;display:flex;align-items:center;gap:.6em;font-weight:800}
    .cart-pill{display:inline-flex;background:var(--accent);color:#7a1517;border-radius:999px;font-weight:800;font-size:.93em;padding:.12em .6em;align-items:center;gap:.4em}

    .modal-bg{display:none;position:fixed;z-index:100;inset:0;background:rgba(0,0,0,.35);align-items:center;justify-content:center}
    .modal-bg.active{display:flex}
    .modal{background:var(--card);border-radius:18px;max-width:560px;width:96vw;padding:1.2em .9em .9em .9em;box-shadow:0 10px 40px rgba(0,0,0,.25);position:relative}
    .modal h2{margin:.2em 2.2em .2em 2.2em;color:var(--primary);text-align:center}
    .close{position:absolute;top:.5em;right:.6em;background:transparent;border:none;font-size:1.6em;color:var(--primary-600);cursor:pointer}
    .carrito-list{max-height:320px;overflow-y:auto;margin:.7em 0 .9em;padding:0 .3em}
    .row{display:grid;grid-template-columns:1fr auto auto auto auto;gap:.5em;align-items:center;padding:.55em 0;border-bottom:1px solid rgba(148,163,184,.2)}
    .row-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .row-mini{display:flex;gap:.35em}
    .mini{width:26px;height:26px;border-radius:50%;border:none;background:var(--primary);color:#fff;font-weight:900;cursor:pointer}
    .row-price{text-align:right;min-width:80px}
    .row-sub{text-align:right;min-width:80px}
    .row-remove{border:1px solid rgba(148,163,184,.25);background:#fff;border-radius:10px;padding:.25em .55em;color:#777;cursor:pointer}
    [data-theme="dark"] .row-remove{background:#0b1220;color:#e2e8f0;border-color:#334155}

    .modal-actions{display:flex;gap:.6em;justify-content:space-between;align-items:center;margin-top:.6em}
    .btn-clear{background:#fff;color:#c1121f;border:1px solid #f0b1b5;border-radius:12px;padding:.55em .9em;cursor:pointer;font-weight:800}
    .total{font-weight:900;color:var(--primary);font-size:1.14em;flex:1;text-align:right}
    .btn-wa{display:block;width:100%;background:#25D366;color:#fff;font-weight:900;border:none;border-radius:24px;padding:.8em 0;font-size:1.08em;text-decoration:none;cursor:pointer;margin-top:.4em;box-shadow:0 4px 18px rgba(37,211,102,.35);text-align:center}

    .toast{position:fixed;right:12px;bottom:12px;background:#052e16;color:#bbf7d0;border:1px solid #166534;padding:10px 12px;border-radius:10px;display:none;z-index:1000}
    .toast.show{display:block}
  </style>
</head>
<body>
  <header>
    <div class="h-in">
      <div class="brand">
        <img src="LOGO-LA-PERUANA.jpg" alt="La Peruana" />
        <strong>La Peruana</strong>
      </div>
      <div class="search">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="q" placeholder="Buscar (ej: medialuna, sandwich, queso…)"/>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn-lite" id="themeToggle"><i class="fa-solid fa-moon"></i> <span id="themeLabel">Claro</span></button>
      </div>
    </div>
  </header>

  <button class="cart-fab" id="openCart"><i class="fa-solid fa-cart-shopping"></i><span>Carrito</span> <span class="cart-pill"><span id="cartCount">0</span> • <span id="cartTotal">$0</span></span></button>

  <div class="layout">
    <aside class="side">
      <h3>Categorías</h3>
      <div id="cats" class="cats"></div>
      <hr style="border-color:rgba(148,163,184,.2)">
      <h3>Filtros</h3>
      <div class="toolbar">
        <select id="sort">
          <option value="relevance">Relevancia</option>
          <option value="price_asc">Precio ↑</option>
          <option value="price_desc">Precio ↓</option>
          <option value="alpha">A–Z</option>
        </select>
        <input id="minp" placeholder="Precio min">
        <input id="maxp" placeholder="Precio max">
        <button class="btn" id="apply">Aplicar</button>
        <button class="btn" id="clear">Limpiar</button>
      </div>
    </aside>

    <main>
      <div class="grid" id="grid"></div>
    </main>
  </div>

  <!-- Modal Carrito (detalle y confirmación) -->
  <div class="modal-bg" id="cartModalBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <button class="close" id="closeCart" title="Cerrar" aria-label="Cerrar">&times;</button>
      <h2 id="cartTitle">Tu Carrito</h2>
      <div class="carrito-list" id="cartList"></div>
      <div class="modal-actions">
        <button class="btn-clear" id="btnClear">Eliminar todo</button>
        <div class="total" id="cartTotalModal"></div>
      </div>
      <a class="btn-wa" id="btnWA" target="_blank" rel="noopener">Confirmar y enviar por WhatsApp</a>
    </div>
  </div>

  <div class="toast" id="toast">Agregado al carrito</div>

  <script>
    // ===== Config =====
    // Cambiá esta ruta si preferís apuntar a tu repo GitHub (por ejemplo, a /assets/img/ del repo Pages)
    // Ejemplo absoluto: const IMAGE_BASE = "https://raw.githubusercontent.com/la-peruana/laperuana/main/img/";
    const IMAGE_BASE = "./img/"; // usar carpeta /img/ del mismo sitio
    const WHATSAPP_NUMBER = "5493435075991"; // sin + ni espacios

    // ===== Utilidades =====
    const CURRENCY = new Intl.NumberFormat("es-AR", {style:"currency", currency:"ARS", maximumFractionDigits:0});
    const fmt = n => CURRENCY.format(n);
    const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");

    const PLACEHOLDER_IMG = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='%23f1f5f9'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%2394a3b8' font-size='28' font-family='Arial'>Imagen</text></svg>";

    // ===== Catálogo (estático, sin Sheets) =====
    const Categories = [
      { id:"rotiseria", name:"Rotisería", icon:"fa-utensils" },
      { id:"panaderia", name:"Panadería", icon:"fa-bread-slice" },
      { id:"pasteleria", name:"Pastelería", icon:"fa-cake-candles" },
      { id:"carniceria", name:"Carnicería", icon:"fa-drumstick-bite" },
      { id:"verduleria", name:"Verdulería", icon:"fa-carrot" },
      { id:"fiambreria", name:"Fiambrería", icon:"fa-cheese" },
      { id:"almacen", name:"Almacén", icon:"fa-boxes-stacked" },
      { id:"bebidas", name:"Bebidas", icon:"fa-champagne-glasses" }
    ];

    // Para mantener el catálogo corto aquí, se incluyen ejemplos. Podés extenderlo copiando la estructura.
    let Catalog = {
  rotiseria:[
    { name:"Torrejas de arroz", price:1225, unit:"x 3 unidades", image:"torrejas-de-arroz.jpg" },
    { name:"Torrejas de acelga", price:1225, unit:"x 3 unidades", image:"torrejas-de-acelga.jpg" },
    { name:"Sándwich Simples", price:12846, unit:"bandeja x 6 un.", image:"sandwich-simples.jpg" },
    { name:"Sándwich Triples", price:13588, unit:"bandeja x 6 un.", image:"sandwich-triples.jpg" },
    { name:"Tortilla de papas", price:4782, unit:"porción", image:"tortilla-de-papas.jpg" },
    { name:"Tortilla de acelga", price:4863, unit:"porción", image:"tortilla-de-acelga.jpg" },
    { name:"Terrina", price:3633, unit:"porción", image:"terrina.jpg" },
    { name:"Papas fritas", price:2591, unit:"porción", image:"papas-fritas.jpg" },
    { name:"Hamburguesa Cheddar c- papas", price:8298, unit:"unidad", image:"hamburguesa-cheddar-c-papas.jpg" },
    { name:"Hamburguesa LP c- papas", price:7447, unit:"unidad", image:"hamburguesa-lp-c-papas.jpg" },
    { name:"Patamuslo", price:13196, unit:"unidad", image:"patamuslo.jpg" },
    { name:"Sándwich milanesa de pollo", price:5637, unit:"unidad", image:"sandwich-milanesa-de-pollo.jpg" },
    { name:"Sándwich milanesa de carne", price:8176, unit:"unidad", image:"sandwich-milanesa-de-carne.jpg" },
    { name:"Sándwich milanesa de carne completo", price:9638, unit:"unidad", image:"sandwich-milanesa-de-carne-completo.jpg" },
    { name:"Pebete de jamón y queso", price:4782, unit:"unidad", image:"pebete-de-jamon-y-queso.jpg" },
    { name:"Empanadas de choclo", price:6168, unit:"x 3 un.", image:"empanadas-de-choclo.jpg" },
    { name:"Empanadas de jamón y queso", price:4875, unit:"x 3 un.", image:"empanadas-de-jamon-y-queso.jpg" },
    { name:"Empanadas Calabresa", price:4190, unit:"unidad", image:"empanadas-calabresa.jpg" },
    { name:"Empanadas de carne dulce", price:5551, unit:"x 3 un.", image:"empanadas-de-carne-dulce.jpg" },
    { name:"Empanadas de verdura", price:4278, unit:"x 3 un.", image:"empanadas-de-verdura.jpg" },
    { name:"Empanadas de carne saladas", price:4923, unit:"x 3 un.", image:"empanadas-de-carne-saladas.jpg" },
    { name:"Empanadas de pollo", price:4713, unit:"x 3 un.", image:"empanadas-de-pollo.jpg" },
    { name:"Milanesas de carne", price:11258, unit:"unidad", image:"milanesas-de-carne.jpg" },
    { name:"Milanesas de pollo", price:8344, unit:"unidad", image:"milanesas-de-pollo.jpg" }
  ],
  panaderia:[
    { name:"Facturas con crema", price:2177, unit:"x 3 un.", image:"facturas-con-crema.jpg" },
    { name:"Facturas con crema y membrillo", price:2613, unit:"x 3 un.", image:"facturas-con-crema-y-membrillo.jpg" },
    { name:"Facturas con crema y dulce de leche", price:1960, unit:"x 3 un.", image:"facturas-con-crema-y-dulce-de-leche.jpg" },
    { name:"Medialunas con dulce de leche", price:0, unit:"", image:"medialunas-con-dulce-de-leche.jpg" },
    { name:"Medialunas saladas", price:1851, unit:"x 3 un.", image:"medialunas-saladas.jpg" },
    { name:"Medialunas marplatenses", price:1851, unit:"x 3 un.", image:"medialunas-marplatenses.jpg" },
    { name:"Medialunas dulces", price:1851, unit:"x 3 un.", image:"medialunas-dulces.jpg" },
    { name:"Pasta frola", price:5523, unit:"unidad", image:"pasta-frola.jpg" },
    { name:"Pastafrola individual", price:2258, unit:"unidad", image:"pastafrola-individual.jpg" },
    { name:"Caracolas con dulce de leche", price:2464, unit:"unidad", image:"caracolas-con-dulce-de-leche.jpg" },
    { name:"Caracolas con crema", price:2464, unit:"unidad", image:"caracolas-con-crema.jpg" },
    { name:"Caracolas con membrillo", price:2464, unit:"unidad", image:"caracolas-con-membrillo.jpg" },
    { name:"Croissant", price:2464, unit:"unidad", image:"croissant.jpg" },
    { name:"Bollito con grasa", price:2000, unit:"x 3 un.", image:"bollito-con-grasa.jpg" },
    { name:"Bollito con membrillo", price:2000, unit:"x 3 un.", image:"bollito-con-membrillo.jpg" },
    { name:"Bollito con crema pastelera", price:2000, unit:"x 3 un.", image:"bollito-con-crema-pastelera.jpg" },
    { name:"Bollito con dulce de leche", price:2000, unit:"x 3 un.", image:"bollito-con-dulce-de-leche.jpg" },
    { name:"Mini Torta Negra", price:2598, unit:"unidad", image:"mini-torta-negra.jpg" },
    { name:"Chinchines", price:1500, unit:"x 100g", image:"chinchines.jpg" },
    { name:"Pan pebete", price:1399, unit:"unidad", image:"pan-pebete.jpg" },
    { name:"Pan de Viena c/ sésamo", price:1249, unit:"unidad", image:"pan-de-viena-c-sesamo.jpg" },
    { name:"Pan de Viena s/ sésamo", price:1199, unit:"unidad", image:"pan-de-viena-s-sesamo.jpg" }
  ],
  pasteleria:[
    { name:"Cheesecake individual", price:6362, unit:"unidad", image:"cheesecake-individual.jpg" },
    { name:"Tiramisú", price:3057, unit:"unidad", image:"tiramisu.jpg" },
    { name:"Bocaditos de coco", price:1500, unit:"x 100g", image:"bocaditos-de-coco.jpg" },
    { name:"Rosquitas de anís", price:1500, unit:"x 100g", image:"rosquitas-de-anis.jpg" },
    { name:"Galletitas de miel", price:1500, unit:"x 100g", image:"galletitas-de-miel.jpg" },
    { name:"Alfajores de chocolate", price:1500, unit:"x 100g", image:"alfajores-de-chocolate.jpg" },
    { name:"Alfajores de maicena", price:1500, unit:"x 100g", image:"alfajores-de-maicena.jpg" },
    { name:"Pepas de membrillo", price:1500, unit:"x 100g", image:"pepas-de-membrillo.jpg" },
    { name:"Scons dulces", price:1500, unit:"x 100g", image:"scons-dulces.jpg" },
    { name:"Scons salados", price:1500, unit:"x 100g", image:"scons-salados.jpg" },
    { name:"Budín inglés", price:4098, unit:"unidad", image:"budin-ingles.jpg" },
    { name:"Torta Sacher con maracuyá", price:17971, unit:"unidad", image:"torta-sacher-con-maracuya.jpg" },
    { name:"Torta estilo Selva Negra", price:17229, unit:"unidad", image:"torta-estilo-selva-negra.jpg" },
    { name:"Torta Red Velvet", price:17971, unit:"unidad", image:"torta-red-velvet.jpg" },
    { name:"Torta de limón", price:14143, unit:"unidad", image:"torta-de-limon.jpg" }
  ],
  carniceria:[
    { name:"Milanesa de carne", price:13500, unit:"kg", image:"milanesa-de-carne.jpg" },
    { name:"Milanesa de pollo", price:0, unit:"kg", image:"milanesa-de-pollo.jpg" },
    { name:"Filet de pechuga", price:15500, unit:"kg", image:"filet-de-pechuga.jpg" },
    { name:"Pollo entero", price:7990, unit:"kg", image:"pollo-entero.jpg" },
    { name:"Costilla de novillo", price:17500, unit:"kg", image:"costilla-de-novillo.jpg" },
    { name:"Asado de novillo", price:16500, unit:"kg", image:"asado-de-novillo.jpg" },
    { name:"Tapa de asado", price:15800, unit:"kg", image:"tapa-de-asado.jpg" },
    { name:"Asado de cerdo", price:14200, unit:"kg", image:"asado-de-cerdo.jpg" }
  ],
  verduleria:[
    { name:"Tomate redondo", price:5496, unit:"kg", image:"tomate-redondo.jpg" },
    { name:"Bananas", price:4101, unit:"kg", image:"bananas.jpg" },
    { name:"Papa negra", price:2050, unit:"kg", image:"papa-negra.jpg" },
    { name:"Cebolla", price:2370, unit:"kg", image:"cebolla.jpg" }
  ],
  fiambreria:[
    { name:"Jamón Cocido Narbona Premium", price:3900, unit:"100g", image:"jamon-cocido-narbona-premium.jpg" },
    { name:"Queso Tybo  rilke", price:2250, unit:"100g", image:"queso-tybo-rilke.jpg" },
    { name:"Queso Pategrás rilke", price:2900, unit:"100g", image:"queso-pategras-rilke.jpg" },
    { name:"Queso Fontina rilke", price:4000, unit:"100g", image:"queso-fontina-rilke.jpg" },
    { name:"Queso Rallado rilke", price:3500, unit:"100g", image:"queso-rallado-rilke.jpg" },
    { name:"Queso Provolone ralado rilke", price:3500, unit:"100g", image:"queso-provolone-rallado-rilke.jpg" },
    { name:"Queso mozzarella rilke", price:3900, unit:"100g", image:"queso-mozzarella-rilke.jpg" },
    { name:"Picada de fiambres y quesos 800g", price:19600, unit:"bandeja", image:"picada-de-fiambres-y-quesos-800g.jpg" }
  ],
  almacen:[
    { name:"Arroz Gallo Oro 1kg", price:2909, unit:"unidad", image:"arroz-gallo-oro-1kg.jpg" },
    { name:"Arroz Gallo Doble Carolina 1kg", price:0, unit:"unidad", image:"arroz-gallo-doble-carolina-1kg.jpg" },
    { name:"Atún La Campagnola trozado 170g", price:1858, unit:"lata", image:"atun-la-campagnola-trozado-170g.jpg" },
    { name:"Aceitunas verdes Luján 500g", price:3283, unit:"frasco", image:"aceitunas-verdes-lujan-500g.jpg" },
    { name:"Aceitunas negras Luján 500g", price:4178, unit:"frasco", image:"aceitunas-negras-lujan-500g.jpg" },
    { name:"Fideos terrabusi tallarín 500g", price:1559, unit:"paquete", image:"fideos-terrabusi-tallarin-500g.jpg" },
    { name:"Fideos terrabusi moños 500g", price:1559, unit:"paquete", image:"fideos-terrabusi-monos-500g.jpg" },
    { name:"Fideos terrabusi codito 500g", price:1559, unit:"paquete", image:"fideos-terrabusi-codito-500g.jpg" },
    { name:"Yerba Sinceridad 1kg", price:3931, unit:"unidad", image:"yerba-sinceridad-1kg.jpg" },
    { name:"Polenta Presto pronta 500g", price:1320, unit:"paquete", image:"polenta-presto-pronta-500g.jpg" },
    { name:"Aceite Natura Blend 900ml", price:2872, unit:"botella", image:"aceite-natura-blend-900ml.jpg" },
    { name:"Azúcar Chango 1kg", price:1918, unit:"paquete", image:"azucar-chango-1kg.jpg" }
  ],
  bebidas:[
    { name:"Coca‑Cola 1.5L", price:3992, unit:"botella", image:"coca-cola-1-5l.jpg" },
    { name:"Coca Cola 2.25L", price:0, unit:"botella", image:"coca-cola-2-25l.jpg" },
    { name:"Coca Cola 2.5L", price:0, unit:"botella", image:"coca-cola-2-5l.jpg" },
    { name:"Pepsi 2.25L", price:0, unit:"botella", image:"pepsi-2-25l.jpg" },
    { name:"Sprite 2.25L", price:0, unit:"botella", image:"sprite-2-25l.jpg" },
    { name:"Fanta 2.25L", price:0, unit:"botella", image:"fanta-2-25l.jpg" },
    { name:"Schweppes tónica 1.5L", price:0, unit:"botella", image:"schweppes-tonica-1-5l.jpg" },
    { name:"Cerveza Quilmes lata 473cc", price:1900, unit:"lata", image:"cerveza-quilmes-lata-473cc.jpg" },
    { name:"Fernet Branca 750ml", price:0, unit:"botella", image:"fernet-branca-750ml.jpg" },
    { name:"Cinzano Rosso 950ml", price:0, unit:"botella", image:"cinzano-rosso-950ml.jpg" },
    { name:"Vino Malbec Alma Mora 750ml", price:0, unit:"botella", image:"vino-malbec-alma-mora-750ml.jpg" }
  ],
  cafeteria:[
    { name:"Café con leche grande + 2 medialunas marplatenses", price:4473, unit:"Combo", image:"cafe-con-leche-grande-2-medialunas-marplatenses.jpg" },
    { name:"Café con leche grande + 2 medialunas saladas", price:4473, unit:"Combo", image:"cafe-con-leche-grande-2-medialunas-saladas.jpg" },
    { name:"Café con leche grande + 2 alfajores de maicena", price:4473, unit:"Combo", image:"cafe-con-leche-grande-2-alfajores-de-maicena.jpg" },
    { name:"Café con leche grande + Croissant", price:4473, unit:"Combo", image:"cafe-con-leche-grande-croissant.jpg" },
    { name:"Café con leche grande + 2 facturas", price:4500, unit:"Combo", image:"cafe-con-leche-grande-2-facturas.jpg" },
    { name:"Café con leche grande + 2 alfajores de chocolate", price:4473, unit:"Combo", image:"cafe-con-leche-grande-2-alfajores-de-chocolate.jpg" }
  ],
};

    // Normalizá las rutas de imagen al base definido
    for(const cat in Catalog){
      Catalog[cat] = Catalog[cat].map(p=> ({...p, image: p.image ? (p.image.startsWith('http')? p.image : IMAGE_BASE + p.image) : undefined}));
    }

    // ===== Estado / Carrito =====
    const State = { theme: localStorage.getItem("shop_theme") || "light", cat: Categories[0].id, q:"", sort:"relevance", minp:"", maxp:"" };

    const Cart = {
      key:"shop_cart_v2",
      data: {},
      load(){ try{ this.data = JSON.parse(localStorage.getItem(this.key)) || {} }catch{ this.data = {} }; UI.sync() },
      save(){ localStorage.setItem(this.key, JSON.stringify(this.data)); UI.sync() },
      add(p){ const id=slug(p.name); if(!this.data[id]) this.data[id]={...p, qty:0}; this.data[id].qty++; this.save(); toast("Agregado") },
      dec(id){ if(!this.data[id]) return; this.data[id].qty--; if(this.data[id].qty<=0) delete this.data[id]; this.save() },
      set(id,q){ if(q<=0) delete this.data[id]; else if(this.data[id]) this.data[id].qty=q; this.save() },
      clear(){ this.data={}; this.save() },
      items(){ return Object.values(this.data) },
      count(){ return this.items().reduce((a,b)=>a+b.qty,0) },
      subtotal(){ return this.items().reduce((a,b)=>a+b.price*b.qty,0) }
    };

    // ===== UI =====
    const toast = (msg) => { const t=document.getElementById("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1400) };

    const UI = {
      init(){
        document.documentElement.setAttribute("data-theme", State.theme);
        document.getElementById("themeLabel").textContent = State.theme==="dark" ? "Oscuro" : "Claro";
        this.cats(); this.grid(); this.bind(); Cart.load();
      },
      bind(){
        document.getElementById("themeToggle").onclick = ()=>{ State.theme = State.theme==="dark" ? "light":"dark"; localStorage.setItem("shop_theme", State.theme); document.documentElement.setAttribute("data-theme", State.theme); document.getElementById("themeLabel").textContent = State.theme==="dark" ? "Oscuro" : "Claro"; };
        document.getElementById("q").oninput = e => { State.q = e.target.value.toLowerCase(); this.grid(); };
        document.getElementById("sort").onchange = e => { State.sort = e.target.value; this.grid(); };
        document.getElementById("apply").onclick = ()=>{ State.minp = document.getElementById("minp").value; State.maxp = document.getElementById("maxp").value; this.grid(); };
        document.getElementById("clear").onclick = ()=>{ State.minp=""; State.maxp=""; document.getElementById("minp").value=""; document.getElementById("maxp").value=""; this.grid(); };

        document.getElementById("openCart").onclick = ()=>{ this.renderCart(); document.getElementById("cartModalBg").classList.add("active"); };
        document.getElementById("closeCart").onclick = ()=> document.getElementById("cartModalBg").classList.remove("active");
        document.getElementById("cartModalBg").onclick = function(e){ if(e.target===this) this.classList.remove("active"); };
        document.getElementById("btnClear").onclick = ()=>{ if(confirm("¿Vaciar todo el carrito?")){ Cart.clear(); UI.renderCart(); toast("Carrito vacío"); } };
      },
      cats(){
        const el = document.getElementById("cats"); el.innerHTML="";
        Categories.forEach(c=>{ const b=document.createElement("button"); b.className=(State.cat===c.id?"active":""); b.innerHTML=`<i class="fa-solid ${c.icon}"></i> ${c.name}`; b.onclick=()=>{ State.cat=c.id; this.cats(); this.grid(); }; el.appendChild(b); });
      },
      productsOf(c){ return Catalog[c.id]||[] },
      grid(){
        const wrap = document.getElementById("grid"); wrap.innerHTML="";
        const cats = State.q ? Categories : Categories.filter(c=>c.id===State.cat);
        cats.forEach(c=>{
          const list = this.productsOf(c)
            .filter(p=> !State.q || p.name.toLowerCase().includes(State.q))
            .filter(p=> (State.minp? p.price>=parseInt(State.minp,10):true) && (State.maxp? p.price<=parseInt(State.maxp,10):true))
            .slice();

          if(State.sort==="price_asc") list.sort((a,b)=>a.price-b.price);
          else if(State.sort==="price_desc") list.sort((a,b)=>b.price-a.price);
          else if(State.sort==="alpha") list.sort((a,b)=> a.name.localeCompare(b.name,'es'));

          list.forEach(p=>{
            const key = slug(p.name);
            const card = document.createElement("div"); card.className="card";
            const th = document.createElement("div"); th.className="thumb";
            if(p.image){ const img=document.createElement("img"); img.alt=p.name; img.src=p.image; img.onerror = ()=> { img.src = PLACEHOLDER_IMG }; th.appendChild(img); }
            else{ const img=document.createElement("img"); img.alt=p.name; img.src=PLACEHOLDER_IMG; th.appendChild(img); }
            card.appendChild(th);
            const info = document.createElement("div"); info.className="info";
            info.innerHTML = `<div class="name">${p.name}</div><div class="unit">${p.unit||""}</div><div class="price">${fmt(p.price)}</div>`;
            const acts = document.createElement("div"); acts.className="actions";
            acts.innerHTML = `<div class="qty">
                <div class="icon" data-act="dec" data-key="${key}"><i class="fa-solid fa-minus"></i></div>
                <input class="btn" style="width:60px;text-align:center" value="${Cart.data[key]?.qty||0}" data-act="set" data-key="${key}"/>
                <div class="icon" data-act="inc" data-key="${key}"><i class="fa-solid fa-plus"></i></div>
              </div>`;
            acts.querySelector('[data-act="inc"]').onclick = () => Cart.add(p);
            acts.querySelector('[data-act="dec"]').onclick = () => Cart.dec(key);
            acts.querySelector('[data-act="set"]').onchange = (e)=>{ const q=Math.max(0,parseInt(e.target.value||"0",10)); if(!Cart.data[key] && q>0) Cart.data[key]={...p,qty:0}; Cart.set(key,q); };
            info.appendChild(acts); card.appendChild(info); wrap.appendChild(card);
          });
        });
        this.sync();
      },
      sync(){
        const count = Cart.count(); document.getElementById("cartCount").textContent = count.toLocaleString('es-AR');
        document.getElementById("cartTotal").textContent = fmt(Cart.subtotal());
        document.querySelectorAll('input[data-act="set"][data-key]').forEach(inp=>{ const key = inp.getAttribute("data-key"); inp.value = Cart.data[key]?.qty || 0; });
      },
      renderCart(){
        const list = document.getElementById('cartList'); list.innerHTML = '';
        const items = Cart.items();
        if(items.length===0){ list.innerHTML = '<div style="text-align:center;color:#777;font-style:italic">¡El carrito está vacío!</div>'; document.getElementById('cartTotalModal').textContent=''; document.getElementById('btnWA').style.display='none'; return; }
        let total = 0;
        items.forEach(it=>{
          const id = slug(it.name);
          const sub = it.qty * it.price; total += sub;
          const row = document.createElement('div'); row.className='row';
          row.innerHTML = `
            <span class="row-name">${it.name}</span>
            <span class="row-price">${fmt(it.price)}</span>
            <div class="row-mini">
              <button class="mini" data-id="${id}" data-action="dec">-</button>
              <span id="carr-q-${id}" style="min-width:28px;text-align:center;font-weight:800;color:var(--primary)">${it.qty}</span>
              <button class="mini" data-id="${id}" data-action="inc">+</button>
            </div>
            <span class="row-sub" id="carr-sub-${id}">${fmt(sub)}</span>
            <button class="row-remove" data-id="${id}" data-action="rm">Quitar</button>`;
          list.appendChild(row);
        });
        document.getElementById('cartTotalModal').textContent = `Total: ${fmt(total)}`;
        const msg = this.whatsAppMessage(items, total);
        const phone = WHATSAPP_NUMBER.replace(/\D/g,"");
        const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
        const btn = document.getElementById('btnWA'); btn.href=url; btn.style.display='block';

        // Delegación de eventos para +/-/quitar
        list.onclick = (e)=>{
          const btn = e.target.closest('button'); if(!btn) return; const id = btn.dataset.id; const action = btn.dataset.action; if(!id||!action) return;
          if(action==='dec'){ Cart.dec(id); }
          if(action==='inc'){ if(!Cart.data[id]) return; Cart.data[id].qty++; Cart.save(); }
          if(action==='rm'){ delete Cart.data[id]; Cart.save(); }
          this.renderCart(); this.grid();
        };
      },
      whatsAppMessage(items,total){
        const lines = items.map(it=> `• ${it.name} x${it.qty} – ${fmt(it.price*it.qty)}`);
        return [`*Pedido La Peruana*`,`\n*Detalle:*`,...lines,`\n*Total:* ${fmt(total)}`].join("\n");
      }
    };

    // === Init ===
    UI.init();
  </script>
</body>
</html>
